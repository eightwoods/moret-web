import{d as u,f as p,s as m,i as d}from"./main.1af5adb8.js";import{a as y,b as h,d as v,e as g,f as S,h as b,i as k}from"./web3.ebe56d3e.js";import n from"./component.dropdownSelect.e149027c.js";import q from"./component.percentageBar.76ea978a.js";import s from"./component.toggleSwitches.d31686b5.js";import x from"./component.tradingviewWidget.ab68800c.js";var A={globals:{elem:document.querySelector(".trader"),init:!0},init(){this.optAmount(),this.optExpiry(),this.buttonTrade();const o={childList:!0,attributes:!0,attributeFilter:["sidenav-activechange","sidenav-refreshprice"]};new MutationObserver(a=>{console.log("sidenav has changed from Trader!");for(let r of a)if(r.type==="attributes")switch(r.attributeName){case"sidenav-activechange":x.createGraph(),this.optTokenName(),document.querySelector(".opt-strike").removeAttribute("dds-selected"),this.optStrike(!0),this.optPrice(),this.liquidityPool(),this.globals.init||this.optToken();break;case"sidenav-refreshprice":this.optPrice(),document.querySelector(".overlay-popup")&&this.optPrice(!0);break}this.globals.init=!1}).observe(this.globals.elem.querySelector(".sidenav"),o);const t={attributes:!0,attributeFilter:["ts-activechanged","dds-updated"]},i=new MutationObserver(a=>{for(let r of a)if(r.attributeName==="ts-activechanged"||r.attributeName==="dds-updated"){if(r.target.classList.contains("opt-callput")){const l=document.querySelector(".opt-strike");parseInt(l.getAttribute("dds-selected"))===0&&n.valueFromInputField(l,l.querySelector(".ds-value1").textContent),this.optStrike()}else r.target.classList.contains("opt-expiry")&&this.optToken();this.optPrice()}});i.observe(document.querySelector(".opt-buysell"),t),i.observe(document.querySelector(".opt-callput"),t),i.observe(document.querySelector(".opt-token"),t),i.observe(document.querySelector(".opt-strike"),t),i.observe(document.querySelector(".opt-expiry"),t);const c=new MutationObserver(a=>{this.optToken(),c.disconnect()});c.observe(document.querySelector(".opt-expiry .ds-value1"),{childList:!0})},optTokenName(){document.querySelector(".opt-token .ts-token-name").textContent=u()},async optToken(){const o=await y(null,this.getExpiryValue());document.querySelector(".opt-token .ts-token").textContent=o},optStrike(o=!1){n.createListItems(document.querySelector(".opt-strike"),h(null,this.isCall()),!1,o)},optAmount(){document.querySelector("input[name='opt-amount']").addEventListener("keydown",e=>{e.keyCode==13&&this.optPrice()},!1)},optExpiry(){n.createListItems(document.querySelector(".opt-expiry"),v())},optPrice(o=!1){new Promise((e,t)=>{setTimeout(()=>{e({strike:this.getStrikeValue(),amount:this.getAmountValue(),expiry:this.getExpiryValue()})},this.globals.init?2e3:500)}).then(async e=>{const t=await g(null,u(),this.isBuy(),this.isCall(),this.getPaymentMethodValue(),e.strike,e.amount,e.expiry);o?(document.querySelector(".overlay-popup .to-volatility span").textContent=t.volatility,document.querySelector(".overlay-popup .to-premium span").textContent=t.premium,document.querySelector(".overlay-popup .to-collateral span").textContent=t.collateral):(document.querySelector(".opt-price .info-volatility").textContent=t.volatility,document.querySelector(".opt-price .info-premium").textContent=t.premium,document.querySelector(".opt-price .info-collateral").textContent=t.collateral)}).catch(e=>console.warn(e))},async liquidityPool(){const o=await S();document.querySelector(".liquidity-pool .pb-price-end").textContent=o.gross,q.progressBar(document.querySelector(".liquidity-pool"),o.perc)},buttonTrade(){document.querySelector(".opt-price .btn").addEventListener("click",async e=>{e.preventDefault();const t=[{name:`${s.getActiveItem(document.querySelector(".opt-buysell"))}:`,span:`call on ${u()} - ${p()}`,class:"to-buy"},{name:"Strike:",span:"-",class:"to-strike"},{name:"Expiry:",span:"-",class:"to-expiry"},{name:"Amount:",span:this.getAmountValue(),class:"to-amount"},{name:"Implied Volatility:",span:"-",class:"to-volatility"},{name:"Premium:",span:"-",class:"to-premium"},{name:"Collateral:",span:"-",class:"to-collateral"}];m("Trade overview",d(t,"tradeoverview")),n.insertValues(document.querySelector(".opt-strike"),document.querySelector(".overlay-popup .to-strike span")),n.insertValues(document.querySelector(".opt-expiry"),document.querySelector(".overlay-popup .to-expiry span"),!0),this.optPrice(!0),setTimeout(()=>this.executeTrade(),1e3)})},executeTrade(){const o=document.createElement("div");o.className="executetrade",document.querySelector(".overlay-popup .op-content").appendChild(o);const e=document.createElement("a");e.setAttribute("href","#"),e.className="btn btn-blue",e.textContent="Execute",o.appendChild(e),e.addEventListener("click",t=>{t.preventDefault(),e.remove(),console.log(null,this.isBuy(),this.isCall(),this.getPaymentMethodValue(),this.getStrikeValue(),this.getAmountValue(),this.getExpiryValue()),b(null,this.isBuy(),this.isCall(),this.getPaymentMethodValue(),this.getStrikeValue(),this.getAmountValue(),this.getExpiryValue()),k(null,this.isBuy(),this.isCall(),this.getPaymentMethodValue(),this.getStrikeValue(),this.getAmountValue(),this.getExpiryValue())},!1)},isBuy(){return s.getActiveItem(document.querySelector(".opt-buysell")).toLowerCase()==="buy"},isCall(){return s.getActiveItem(document.querySelector(".opt-callput")).toLowerCase()==="call"},getPaymentMethodValue(){return s.getActiveItem(document.querySelector(".opt-token"),!0)},getStrikeValue(){return document.querySelector(".opt-strike .ds-value1").textContent.trim()},getAmountValue(){return document.querySelector("input[name='opt-amount']").value},getExpiryValue(){return document.querySelector(".opt-expiry .ds-value1").textContent.replace("Days","").replace("Day","").trim()}};export{A as default};
