import{t as E,e as tt,g as p,a as x,m as Z,b as F}from"./main.7b461383.js";var it=20,st=1,V=1e6,Q=1e6,lt=-7,ct=21,ut=!1,G="[big.js] ",W=G+"Invalid ",z=W+"decimal places",ht=W+"rounding mode",et=G+"Division by zero",d={},j=void 0,ft=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function ot(){function t(e){var o=this;if(!(o instanceof t))return e===j?ot():new t(e);if(e instanceof t)o.s=e.s,o.e=e.e,o.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(W+"value");e=e===0&&1/e<0?"-0":String(e)}mt(o,e)}o.constructor=t}return t.prototype=d,t.DP=it,t.RM=st,t.NE=lt,t.PE=ct,t.strict=ut,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function mt(t,e){var o,r,n;if(!ft.test(e))throw Error(W+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(o=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(o<0&&(o=r),o+=+e.slice(r+1),e=e.substring(0,r)):o<0&&(o=e.length),n=e.length,r=0;r<n&&e.charAt(r)=="0";)++r;if(r==n)t.c=[t.e=0];else{for(;n>0&&e.charAt(--n)=="0";);for(t.e=o-r-1,t.c=[],o=0;r<=n;)t.c[o++]=+e.charAt(r++)}return t}function S(t,e,o,r){var n=t.c;if(o===j&&(o=t.constructor.RM),o!==0&&o!==1&&o!==2&&o!==3)throw Error(ht);if(e<1)r=o===3&&(r||!!n[0])||e===0&&(o===1&&n[0]>=5||o===2&&(n[0]>5||n[0]===5&&(r||n[1]!==j))),n.length=1,r?(t.e=t.e-e+1,n[0]=1):n[0]=t.e=0;else if(e<n.length){if(r=o===1&&n[e]>=5||o===2&&(n[e]>5||n[e]===5&&(r||n[e+1]!==j||n[e-1]&1))||o===3&&(r||!!n[0]),n.length=e--,r)for(;++n[e]>9;)n[e]=0,e--||(++t.e,n.unshift(1));for(e=n.length;!n[--e];)n.pop()}return t}function O(t,e,o){var r=t.e,n=t.c.join(""),a=n.length;if(e)n=n.charAt(0)+(a>1?"."+n.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)n="0"+n;n="0."+n}else if(r>0)if(++r>a)for(r-=a;r--;)n+="0";else r<a&&(n=n.slice(0,r)+"."+n.slice(r));else a>1&&(n=n.charAt(0)+"."+n.slice(1));return t.s<0&&o?"-"+n:n}d.abs=function(){var t=new this.constructor(this);return t.s=1,t};d.cmp=function(t){var e,o=this,r=o.c,n=(t=new o.constructor(t)).c,a=o.s,l=t.s,i=o.e,u=t.e;if(!r[0]||!n[0])return r[0]?a:n[0]?-l:0;if(a!=l)return a;if(e=a<0,i!=u)return i>u^e?1:-1;for(l=(i=r.length)<(u=n.length)?i:u,a=-1;++a<l;)if(r[a]!=n[a])return r[a]>n[a]^e?1:-1;return i==u?0:i>u^e?1:-1};d.div=function(t){var e=this,o=e.constructor,r=e.c,n=(t=new o(t)).c,a=e.s==t.s?1:-1,l=o.DP;if(l!==~~l||l<0||l>V)throw Error(z);if(!n[0])throw Error(et);if(!r[0])return t.s=a,t.c=[t.e=0],t;var i,u,s,m,h,g=n.slice(),T=i=n.length,M=r.length,f=r.slice(0,i),w=f.length,b=t,C=b.c=[],N=0,P=l+(b.e=e.e-t.e)+1;for(b.s=a,a=P<0?0:P,g.unshift(0);w++<i;)f.push(0);do{for(s=0;s<10;s++){if(i!=(w=f.length))m=i>w?1:-1;else for(h=-1,m=0;++h<i;)if(n[h]!=f[h]){m=n[h]>f[h]?1:-1;break}if(m<0){for(u=w==i?n:g;w;){if(f[--w]<u[w]){for(h=w;h&&!f[--h];)f[h]=9;--f[h],f[w]+=10}f[w]-=u[w]}for(;!f[0];)f.shift()}else break}C[N++]=m?s:++s,f[0]&&m?f[w]=r[T]||0:f=[r[T]]}while((T++<M||f[0]!==j)&&a--);return!C[0]&&N!=1&&(C.shift(),b.e--,P--),N>P&&S(b,P,o.RM,f[0]!==j),b};d.eq=function(t){return this.cmp(t)===0};d.gt=function(t){return this.cmp(t)>0};d.gte=function(t){return this.cmp(t)>-1};d.lt=function(t){return this.cmp(t)<0};d.lte=function(t){return this.cmp(t)<1};d.minus=d.sub=function(t){var e,o,r,n,a=this,l=a.constructor,i=a.s,u=(t=new l(t)).s;if(i!=u)return t.s=-u,a.plus(t);var s=a.c.slice(),m=a.e,h=t.c,g=t.e;if(!s[0]||!h[0])return h[0]?t.s=-u:s[0]?t=new l(a):t.s=1,t;if(i=m-g){for((n=i<0)?(i=-i,r=s):(g=m,r=h),r.reverse(),u=i;u--;)r.push(0);r.reverse()}else for(o=((n=s.length<h.length)?s:h).length,i=u=0;u<o;u++)if(s[u]!=h[u]){n=s[u]<h[u];break}if(n&&(r=s,s=h,h=r,t.s=-t.s),(u=(o=h.length)-(e=s.length))>0)for(;u--;)s[e++]=0;for(u=e;o>i;){if(s[--o]<h[o]){for(e=o;e&&!s[--e];)s[e]=9;--s[e],s[o]+=10}s[o]-=h[o]}for(;s[--u]===0;)s.pop();for(;s[0]===0;)s.shift(),--g;return s[0]||(t.s=1,s=[g=0]),t.c=s,t.e=g,t};d.mod=function(t){var e,o=this,r=o.constructor,n=o.s,a=(t=new r(t)).s;if(!t.c[0])throw Error(et);return o.s=t.s=1,e=t.cmp(o)==1,o.s=n,t.s=a,e?new r(o):(n=r.DP,a=r.RM,r.DP=r.RM=0,o=o.div(t),r.DP=n,r.RM=a,this.minus(o.times(t)))};d.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};d.plus=d.add=function(t){var e,o,r,n=this,a=n.constructor;if(t=new a(t),n.s!=t.s)return t.s=-t.s,n.minus(t);var l=n.e,i=n.c,u=t.e,s=t.c;if(!i[0]||!s[0])return s[0]||(i[0]?t=new a(n):t.s=n.s),t;if(i=i.slice(),e=l-u){for(e>0?(u=l,r=s):(e=-e,r=i),r.reverse();e--;)r.push(0);r.reverse()}for(i.length-s.length<0&&(r=s,s=i,i=r),e=s.length,o=0;e;i[e]%=10)o=(i[--e]=i[e]+s[e]+o)/10|0;for(o&&(i.unshift(o),++u),e=i.length;i[--e]===0;)i.pop();return t.c=i,t.e=u,t};d.pow=function(t){var e=this,o=new e.constructor("1"),r=o,n=t<0;if(t!==~~t||t<-Q||t>Q)throw Error(W+"exponent");for(n&&(t=-t);t&1&&(r=r.times(e)),t>>=1,!!t;)e=e.times(e);return n?o.div(r):r};d.prec=function(t,e){if(t!==~~t||t<1||t>V)throw Error(W+"precision");return S(new this.constructor(this),t,e)};d.round=function(t,e){if(t===j)t=0;else if(t!==~~t||t<-V||t>V)throw Error(z);return S(new this.constructor(this),t+this.e+1,e)};d.sqrt=function(){var t,e,o,r=this,n=r.constructor,a=r.s,l=r.e,i=new n("0.5");if(!r.c[0])return new n(r);if(a<0)throw Error(G+"No square root");a=Math.sqrt(r+""),a===0||a===1/0?(e=r.c.join(""),e.length+l&1||(e+="0"),a=Math.sqrt(e),l=((l+1)/2|0)-(l<0||l&1),t=new n((a==1/0?"5e":(a=a.toExponential()).slice(0,a.indexOf("e")+1))+l)):t=new n(a+""),l=t.e+(n.DP+=4);do o=t,t=i.times(o.plus(r.div(o)));while(o.c.slice(0,l).join("")!==t.c.slice(0,l).join(""));return S(t,(n.DP-=4)+t.e+1,n.RM)};d.times=d.mul=function(t){var e,o=this,r=o.constructor,n=o.c,a=(t=new r(t)).c,l=n.length,i=a.length,u=o.e,s=t.e;if(t.s=o.s==t.s?1:-1,!n[0]||!a[0])return t.c=[t.e=0],t;for(t.e=u+s,l<i&&(e=n,n=a,a=e,s=l,l=i,i=s),e=new Array(s=l+i);s--;)e[s]=0;for(u=i;u--;){for(i=0,s=l+u;s>u;)i=e[s]+a[u]*n[s-u-1]+i,e[s--]=i%10,i=i/10|0;e[s]=i}for(i?++t.e:e.shift(),u=e.length;!e[--u];)e.pop();return t.c=e,t};d.toExponential=function(t,e){var o=this,r=o.c[0];if(t!==j){if(t!==~~t||t<0||t>V)throw Error(z);for(o=S(new o.constructor(o),++t,e);o.c.length<t;)o.c.push(0)}return O(o,!0,!!r)};d.toFixed=function(t,e){var o=this,r=o.c[0];if(t!==j){if(t!==~~t||t<0||t>V)throw Error(z);for(o=S(new o.constructor(o),t+o.e+1,e),t=t+o.e+1;o.c.length<t;)o.c.push(0)}return O(o,!1,!!r)};d[Symbol.for("nodejs.util.inspect.custom")]=d.toJSON=d.toString=function(){var t=this,e=t.constructor;return O(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};d.toNumber=function(){var t=Number(O(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(G+"Imprecise conversion");return t};d.toPrecision=function(t,e){var o=this,r=o.constructor,n=o.c[0];if(t!==j){if(t!==~~t||t<1||t>V)throw Error(W+"precision");for(o=S(new r(o),t,e);o.c.length<t;)o.c.push(0)}return O(o,t<=o.e||o.e<=r.NE||o.e>=r.PE,!!n)};d.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(G+"valueOf disallowed");return O(t,t.e<=e.NE||t.e>=e.PE,!0)};var gt=ot(),k=gt;function R(t){var e=0;if(t>=8)e=1;else if(t<=-8)e=0;else{for(var o=0;o<100;o++)e+=Math.pow(t,2*o+1)/wt(2*o+1);e*=Math.pow(Math.E,-.5*Math.pow(t,2)),e/=Math.sqrt(2*Math.PI),e+=.5}return e}function wt(t){for(var e=1,o=t;o>1;o-=2)e*=o;return e}function dt(t,e,o,r,n,a){var l=null,i=(n*o+Math.pow(r,2)*o/2-Math.log(e/t))/(r*Math.sqrt(o));return a==="call"?l=t*R(i)-e*Math.pow(Math.E,-1*n*o)*R(i-r*Math.sqrt(o)):l=e*Math.pow(Math.E,-1*n*o)*R(r*Math.sqrt(o)-i)-t*R(-i),l}function pt(t,e,o,r,n){var a=(n*o+Math.pow(r,2)*o/2-Math.log(e/t))/(r*Math.sqrt(o));return a}var vt={blackScholes:dt,stdNormCDF:R,getW:pt},A=vt;function J(t){return Math.pow(Math.E,-1*Math.pow(t,2)/2)/Math.sqrt(2*Math.PI)}function bt(t,e,o,r,n,a){return a==="call"?rt(t,e,o,r,n):Tt(t,e,o,r,n)}function rt(t,e,o,r,n){var a=A.getW(t,e,o,r,n),l=null;return isFinite(a)?l=A.stdNormCDF(a):l=t>e?1:0,l}function Tt(t,e,o,r,n){var a=rt(t,e,o,r,n)-1;return a==-1&&e==t?0:a}function Mt(t,e,o,r,n,a,l){return l=l||100,a==="call"?Nt(t,e,o,r,n)/l:Ct(t,e,o,r,n)/l}function Nt(t,e,o,r,n){var a=A.getW(t,e,o,r,n);return isNaN(a)?0:e*o*Math.pow(Math.E,-1*n*o)*A.stdNormCDF(a-r*Math.sqrt(o))}function Ct(t,e,o,r,n){var a=A.getW(t,e,o,r,n);return isNaN(a)?0:-1*e*o*Math.pow(Math.E,-1*n*o)*A.stdNormCDF(r*Math.sqrt(o)-a)}function kt(t,e,o,r,n){var a=A.getW(t,e,o,r,n);return isFinite(a)?t*Math.sqrt(o)*J(a)/100:0}function Et(t,e,o,r,n,a,l){return l=l||365,a==="call"?qt(t,e,o,r,n)/l:Pt(t,e,o,r,n)/l}function qt(t,e,o,r,n){var a=A.getW(t,e,o,r,n);return isFinite(a)?-1*r*t*J(a)/(2*Math.sqrt(o))-e*n*Math.pow(Math.E,-1*n*o)*A.stdNormCDF(a-r*Math.sqrt(o)):0}function Pt(t,e,o,r,n){var a=A.getW(t,e,o,r,n);return isFinite(a)?-1*r*t*J(a)/(2*Math.sqrt(o))+e*n*Math.pow(Math.E,-1*n*o)*A.stdNormCDF(r*Math.sqrt(o)-a):0}function At(t,e,o,r,n){var a=A.getW(t,e,o,r,n);return isFinite(a)?J(a)/(t*r*Math.sqrt(o)):0}var U={getDelta:bt,getVega:kt,getGamma:At,getTheta:Et,getRho:Mt};const c=new Web3(window.ethereum),v=async(t,e,o)=>{const n=await(await fetch(e)).json();return new t.eth.Contract(n.abi,o)},_=async(t=null)=>{const e=t||E(),r=await(await v(c,p("Moret.json"),F)).methods.getVolatilityChain(String(e)).call();return await v(c,p("VolatilityChain.json"),r)},Ft=async(t=null)=>{const e=t||E(),r=await(await _(e)).methods.queryPrice().call();return`$${k(c.utils.fromWei(r)).round(2).toNumber()}`},Vt=async(t=null,e)=>{const o=t||E(),n=await(await _(o)).methods.queryPrice().call(),a=k(c.utils.fromWei(n)).toNumber(),l=[.6,.7,.8,.85,.9,.95,1,1.05,1.1,1.15,1.2,1.3,1.4],i=50,u=[];for(let s of l){let m=k(a).times(s).div(i).round().times(i).toNumber(),h=await jt(o,m,e);u.push(`${m} | ${h}`)}return u},jt=async(t=null,e,o)=>{const r=t||E(),a=await(await _(r)).methods.queryPrice().call(),l=k(c.utils.fromWei(a)).toNumber(),i=k(e).div(l).times(100).round().toNumber();return i===100?"ATM":i>100?`${(i-100).toString()}${o?"% OTM":"% ITM"}`:`${(100-i).toString()}${o?"% ITM":"% OTM"}`},Wt=async(t=null)=>{const e=t||E(),o=await _(e);let r=[];for(let n of tt){const a=k(n).times(86400).round().toNumber(),l=k(n).div(365),i=await o.methods.queryVol(a).call(),u=`${k(c.utils.fromWei(i)).div(l.sqrt()).toNumber().toLocaleString(void 0,{style:"percent",minimumFractionDigits:0})} RV`,s=k(n).eq(1)?"":"s";r.push(`${n} Day${s} | ${u}`)}return r},xt=async(t=null,e)=>{const o=t||E(),r=await v(c,p("Moret.json"),F),n=k(e).times(86400).round().toNumber();try{const a=await r.methods.getVolatilityToken(o,n).call();return await(await v(c,p("VolatilityToken.json"),a)).methods.symbol().call()}catch{return""}},nt=async(t=null,e=null,o,r,n,a,l,i)=>{try{if(a<=0)throw"Strike not set correctly.";if(i<=0)throw"Expiry not set correctly";const f=t||E(),w=await v(c,p("Exchange.json"),x),b=Math.floor(i*86400),C=await X(f);var u=0 .toString(16),s,m,h=0,g=0;for(let N=0;N<C.length;N++){const P=C[N],q=await w.methods.queryOption(P,b,c.utils.toWei(a.toString(),"ether"),c.utils.toWei(l.toString(),"ether"),r?0:1,o?0:1,!1).call(),y=parseFloat(c.utils.fromWei(c.utils.toBN(q[0])));(parseInt(u,16)==0||o&&y<s||!o&&y>s)&&(s=y,m=parseFloat(c.utils.fromWei(c.utils.toBN(q[1]))),g=parseFloat(c.utils.fromWei(c.utils.toBN(q[2]))),h=parseFloat(c.utils.fromWei(c.utils.toBN(q[3]))),u=P)}if(h==0||g==0)throw"There is no available liquidity pool.";var T="USDC",M="USDC";return n==0||(n==1?(s=s/g,m=m/g,T=M=e):n==2&&(s=s/h,T=await xt(f,i))),e?{volatility:h.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0}),premium:`${k(s).round(3)} ${T}`,collateral:`${k(m).round(2)} ${M}`,error:""}:{volatility:h,premium:s,collateral:m,pool:u,error:""}}catch(f){return{volatility:"-",premium:"-",collateral:"-",error:f.message}}},X=async(t=null)=>{const e=t||E(),r=await(await v(c,p("Moret.json"),F)).methods.broker().call();return await(await v(c,p("MoretBroker.json"),r)).methods.getAllPools(e).call()},St=async(t=null)=>{const e=t||E(),r=await(await v(c,p("Exchange.json"),x)).methods.vault().call(),n=await v(c,p("OptionVault.json"),r),a=await X(e);var l=0,i=0;for(let m=0;m<a.length;m++){const h=a[m],g=await n.methods.calcCapital(h,!1,!1).call(),T=await n.methods.calcCapital(h,!0,!1).call();l=l+parseFloat(c.utils.fromWei(g)),i=i+parseFloat(c.utils.fromWei(T))}const u=l-i,s=Math.max(0,1-i/l);return{gross:`$${(l/1e3).toFixed(3)}K`,utilized:`$${(u/1e3).toFixed(3)}K`,perc:s*100,text:s.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0})}},Bt=async(t=null,e,o,r,n,a,l)=>{const i=t||E(),u=await v(c,p("Moret.json"),F),s=await nt(i,null,e,o,r,n,a,l);console.log(s);const m=await u.methods.funding().call(),h=Math.floor(l*86400);var g=r==0?m:i;if(r==2)try{g=await u.methods.getVolatilityToken(i,h).call()}catch{console.log(`no vol token exists for ${l.toString()}`)}const T=await v(c,p("ERC20.json"),g),M=await v(c,p("ERC20.json"),r==1?i:m);var f=await ethereum.request({method:"eth_requestAccounts"}),w=c.utils.toChecksumAddress(f[0]);try{await H(T,w,x,s.premium),M._address!=T._address&&await H(M,w,x,s.collateral)}catch(b){return console.warn(b),"failure"}},H=async(t,e,o,r)=>{var n=await t.methods.allowance(e,o).call();const a=await t.methods.decimals().call(),l=c.utils.toBN(c.utils.toWei(r.toString())).mul(c.utils.toBN(10).pow(c.utils.toBN(18-Number(a))));if(console.log(n,r,l),l.gt(c.utils.toBN(n))){var i=await c.eth.getGasPrice(),u=await t.methods.approve(o,Z).estimateGas({from:e,gasPrice:i});u=Number(c.utils.toBN(u).mul(c.utils.toBN(Number(150))).div(c.utils.toBN(Number(100))));var s=await c.eth.getTransactionCount(e);await t.methods.approve(o,Z).send({from:e,gas:u,gasPrice:i,nonce:s})}},$t=async(t=null,e,o,r,n,a,l)=>{const i=t||E(),u=await nt(i,null,e,o,r,n,a,l),s=c.utils.toChecksumAddress(u.pool),m=Math.floor(l*86400);var h=await ethereum.request({method:"eth_requestAccounts"}),g=c.utils.toChecksumAddress(h[0]);try{const w=await v(c,p("Exchange.json"),x);var T=await c.eth.getGasPrice(),M=await w.methods.tradeOption(s,m,c.utils.toWei(n.toString()),c.utils.toWei(a.toString()),o?0:1,e?0:1,r).estimateGas({from:g,gasPrice:T});M=Number(c.utils.toBN(M).mul(c.utils.toBN(Number(150))).div(c.utils.toBN(Number(100))));var f=await c.eth.getTransactionCount(g);let b=null;return await w.methods.tradeOption(s,m,c.utils.toWei(n.toString()),c.utils.toWei(a.toString()),o?0:1,e?0:1,r).send({from:g,gas:M,gasPrice:T,nonce:f}).on("transactionHash",C=>{b=`https://polygonscan.com/tx/${C}`}).on("error",function(C,N){return""}),b}catch(w){return console.warn(w),""}},Ot=async(t=null)=>{const e=t||E(),r=await(await v(c,p("Exchange.json"),x)).methods.vault().call(),n=await v(c,p("OptionVault.json"),r),a=await _(e);var l=await a.methods.queryPrice().call(),i=parseFloat(c.utils.fromWei(l)),u=await ethereum.request({method:"eth_requestAccounts"});c.utils.toChecksumAddress(u[0]);const s=await X(e);let m=[];var h=Math.round(new Date().getTime()/1e3);return await Promise.all(s.map(async g=>{const T=await n.methods.getActiveOptions(g).call();await Promise.all(T.map(async M=>{let f=await n.methods.getOption(M).call(),w=Math.floor(f.maturity-h),b=w/(3600*24*365),C=parseFloat(c.utils.fromWei(f.strike)),N=parseFloat(c.utils.fromWei(f.amount)),P=f.poType==0?"call":"put",q=f.side==0?1:-1,y,B,$,I;if(w>0){let L=await a.methods.queryVol(w).call(),D=parseFloat(c.utils.fromWei(L))/Math.sqrt(b);y=U.getDelta(i,C,b,D,0,P)*q*N,B=U.getGamma(i,C,b,D,0)*q*N,$=U.getVega(i,C,b,D,0)*q*N,I=U.getTheta(i,C,b,D,0,P)*q*N,m.push({Type:f.poType==0?"Call":"Put",BS:f.side==0?"Buy":"Sell",Expiry:new Date(f.maturity*1e3).toLocaleString(),Strike:C.toFixed(0),Amount:N.toFixed(3),Delta:y.toFixed(3),Gamma:B.toFixed(3),Vega:$.toFixed(3),Theta:I.toFixed(3)})}}))})),m},at=async(t=null,e=null,o,r,n)=>{try{if(n<=0)throw"Expiry not set correctly";const s=t||E(),m=await v(c,p("Exchange.json"),x),h=await _(s),g=Math.floor(n*86400),T=n/365,M=await h.methods.queryVol(g).call(),f=await h.methods.queryPrice().call(),w=r/parseFloat(c.utils.fromWei(M))/parseFloat(c.utils.fromWei(f))/.4,b=await yt(s);var a,l,i=0;const N=await(await v(c,p("Moret.json"),F)).methods.getVolatilityToken(s,g).call(),q=await(await v(c,p("VolatilityToken.json"),N)).methods.symbol().call(),y="USDC";var u=0 .toString(16);if(b.length==0)throw"There is no available pool to trade volatility tokens with.";for(let B=0;B<b.length;B++){const $=b[B],I=await m.methods.queryOption($,g,f,c.utils.toWei(w.toFixed(18),"ether"),0,o?0:1,!0).call(),L=parseFloat(c.utils.fromWei(c.utils.toBN(I[0]))),D=parseFloat(c.utils.fromWei(I[3])),Y=(o?L:L/D)/r*w,K=r/D;(parseInt(u,16)==0||a<K)&&(a=K,u=$,i=D,l=Y)}return e?{volatility:i.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0}),premium:`${k(r).round(5)} ${y}`,volpremium:`${k(a).round(5)} ${q}`}:{volatility:i,premium:r,volpremium:a,notional:l,voltoken:N,pool:u}}catch(s){return console.log(s.message),{volatility:"-",premium:"-",volpremium:"-",error:s.message}}},yt=async t=>{const e=await v(c,p("Moret.json"),F),o=await e.methods.broker().call(),n=await(await v(c,p("MoretBroker.json"),o)).methods.getAllPools(t).call();var a=[];for(let l=0;l<n.length;l++)await e.methods.existVolTradingPool(n[l]).call()&&a.push(n[l]);return a},_t=async(t=null,e,o,r)=>{const n=t||E(),a=await v(c,p("Moret.json"),F),l=await at(n,null,e,o,r);var i=await ethereum.request({method:"eth_requestAccounts"}),u=c.utils.toChecksumAddress(i[0]);if(e){const s=await a.methods.funding().call(),m=await v(c,p("ERC20.json"),s);await H(m,u,x,l.premium)}else{const s=c.utils.toChecksumAddress(l.voltoken),m=await v(c,p("ERC20.json"),s);await H(m,u,x,l.volpremium)}},It=async(t=null,e,o,r)=>{try{const s=t||E(),m=await at(s,null,e,o,r),h=c.utils.toChecksumAddress(m.pool),g=c.utils.toWei(m.notional.toFixed(18),"ether"),T=Math.floor(r*86400);var n=await ethereum.request({method:"eth_requestAccounts"}),a=c.utils.toChecksumAddress(n[0]);const M=await v(c,p("Exchange.json"),x);var l=await c.eth.getGasPrice(),i=await M.methods.tradeVolToken(h,T,g,e?0:1).estimateGas({from:a,gasPrice:l});i=Number(c.utils.toBN(i).mul(c.utils.toBN(Number(150))).div(c.utils.toBN(Number(100))));var u=await c.eth.getTransactionCount(a);await M.methods.tradeVolToken(h,T,g,e?0:1).send({from:a,gas:i,gasPrice:l,nonce:u}).on("transactionHash",f=>(console.log(`https://polygonscan.com/tx/${f}`),`https://polygonscan.com/tx/${f}`)).on("error",function(f,w){return""})}catch(s){return console.warn(s),""}},Rt=async(t=null)=>{const e=t||E(),o=await v(c,p("Moret.json"),F),r=await o.methods.getVolatilityChain(String(e)).call(),n=await v(c,p("VolatilityChain.json"),r);var a=await ethereum.request({method:"eth_requestAccounts"}),l=c.utils.toChecksumAddress(a[0]);let i=[];return await Promise.all(tt.map(async u=>{try{const s=k(u).times(86400).round().toNumber(),m=u/365,h=await n.methods.queryVol(s).call(),g=k(u).eq(1)?"":"s",T=await o.methods.getVolatilityToken(String(e),s).call(),M=await v(c,p("VolatilityToken.json"),T),f=await M.methods.balanceOf(l).call(),w=await M.methods.symbol().call(),b=parseFloat(c.utils.fromWei(h))/Math.sqrt(m);i.push({Token:w,Tenor:`${u} Day${g}`,Amount:parseFloat(c.utils.fromWei(f)).toFixed(4),ImpliedVolatility:b.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0})})}catch(s){console.log(s.message)}})),i};export{k as B,xt as a,Vt as b,jt as c,Wt as d,nt as e,St as f,Ft as g,Bt as h,$t as i,Ot as j,at as k,_t as l,It as m,Rt as n,c as w};
