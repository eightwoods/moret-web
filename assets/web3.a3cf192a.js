import{t as P,g as d,e as R,m as V}from"./main.d0b2d0c0.js";var L=20,z=1,D=1e6,F=1e6,H=-7,J=21,X=!1,$="[big.js] ",T=$+"Invalid ",I=T+"decimal places",K=T+"rounding mode",O=$+"Division by zero",h={},p=void 0,Y=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function _(){function t(e){var r=this;if(!(r instanceof t))return e===p?_():new t(e);if(e instanceof t)r.s=e.s,r.e=e.e,r.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(T+"value");e=e===0&&1/e<0?"-0":String(e)}Z(r,e)}r.constructor=t}return t.prototype=h,t.DP=L,t.RM=z,t.NE=H,t.PE=J,t.strict=X,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function Z(t,e){var r,i,o;if(!Y.test(e))throw Error(T+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(r=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(r<0&&(r=i),r+=+e.slice(i+1),e=e.substring(0,i)):r<0&&(r=e.length),o=e.length,i=0;i<o&&e.charAt(i)=="0";)++i;if(i==o)t.c=[t.e=0];else{for(;o>0&&e.charAt(--o)=="0";);for(t.e=r-i-1,t.c=[],r=0;i<=o;)t.c[r++]=+e.charAt(i++)}return t}function A(t,e,r,i){var o=t.c;if(r===p&&(r=t.constructor.RM),r!==0&&r!==1&&r!==2&&r!==3)throw Error(K);if(e<1)i=r===3&&(i||!!o[0])||e===0&&(r===1&&o[0]>=5||r===2&&(o[0]>5||o[0]===5&&(i||o[1]!==p))),o.length=1,i?(t.e=t.e-e+1,o[0]=1):o[0]=t.e=0;else if(e<o.length){if(i=r===1&&o[e]>=5||r===2&&(o[e]>5||o[e]===5&&(i||o[e+1]!==p||o[e-1]&1))||r===3&&(i||!!o[0]),o.length=e--,i)for(;++o[e]>9;)o[e]=0,e--||(++t.e,o.unshift(1));for(e=o.length;!o[--e];)o.pop()}return t}function B(t,e,r){var i=t.e,o=t.c.join(""),s=o.length;if(e)o=o.charAt(0)+(s>1?"."+o.slice(1):"")+(i<0?"e":"e+")+i;else if(i<0){for(;++i;)o="0"+o;o="0."+o}else if(i>0)if(++i>s)for(i-=s;i--;)o+="0";else i<s&&(o=o.slice(0,i)+"."+o.slice(i));else s>1&&(o=o.charAt(0)+"."+o.slice(1));return t.s<0&&r?"-"+o:o}h.abs=function(){var t=new this.constructor(this);return t.s=1,t};h.cmp=function(t){var e,r=this,i=r.c,o=(t=new r.constructor(t)).c,s=r.s,l=t.s,n=r.e,a=t.e;if(!i[0]||!o[0])return i[0]?s:o[0]?-l:0;if(s!=l)return s;if(e=s<0,n!=a)return n>a^e?1:-1;for(l=(n=i.length)<(a=o.length)?n:a,s=-1;++s<l;)if(i[s]!=o[s])return i[s]>o[s]^e?1:-1;return n==a?0:n>a^e?1:-1};h.div=function(t){var e=this,r=e.constructor,i=e.c,o=(t=new r(t)).c,s=e.s==t.s?1:-1,l=r.DP;if(l!==~~l||l<0||l>D)throw Error(I);if(!o[0])throw Error(O);if(!i[0])return t.s=s,t.c=[t.e=0],t;var n,a,c,g,u,v=o.slice(),k=n=o.length,q=i.length,w=i.slice(0,n),m=w.length,j=t,C=j.c=[],x=0,E=l+(j.e=e.e-t.e)+1;for(j.s=s,s=E<0?0:E,v.unshift(0);m++<n;)w.push(0);do{for(c=0;c<10;c++){if(n!=(m=w.length))g=n>m?1:-1;else for(u=-1,g=0;++u<n;)if(o[u]!=w[u]){g=o[u]>w[u]?1:-1;break}if(g<0){for(a=m==n?o:v;m;){if(w[--m]<a[m]){for(u=m;u&&!w[--u];)w[u]=9;--w[u],w[m]+=10}w[m]-=a[m]}for(;!w[0];)w.shift()}else break}C[x++]=g?c:++c,w[0]&&g?w[m]=i[k]||0:w=[i[k]]}while((k++<q||w[0]!==p)&&s--);return!C[0]&&x!=1&&(C.shift(),j.e--,E--),x>E&&A(j,E,r.RM,w[0]!==p),j};h.eq=function(t){return this.cmp(t)===0};h.gt=function(t){return this.cmp(t)>0};h.gte=function(t){return this.cmp(t)>-1};h.lt=function(t){return this.cmp(t)<0};h.lte=function(t){return this.cmp(t)<1};h.minus=h.sub=function(t){var e,r,i,o,s=this,l=s.constructor,n=s.s,a=(t=new l(t)).s;if(n!=a)return t.s=-a,s.plus(t);var c=s.c.slice(),g=s.e,u=t.c,v=t.e;if(!c[0]||!u[0])return u[0]?t.s=-a:c[0]?t=new l(s):t.s=1,t;if(n=g-v){for((o=n<0)?(n=-n,i=c):(v=g,i=u),i.reverse(),a=n;a--;)i.push(0);i.reverse()}else for(r=((o=c.length<u.length)?c:u).length,n=a=0;a<r;a++)if(c[a]!=u[a]){o=c[a]<u[a];break}if(o&&(i=c,c=u,u=i,t.s=-t.s),(a=(r=u.length)-(e=c.length))>0)for(;a--;)c[e++]=0;for(a=e;r>n;){if(c[--r]<u[r]){for(e=r;e&&!c[--e];)c[e]=9;--c[e],c[r]+=10}c[r]-=u[r]}for(;c[--a]===0;)c.pop();for(;c[0]===0;)c.shift(),--v;return c[0]||(t.s=1,c=[v=0]),t.c=c,t.e=v,t};h.mod=function(t){var e,r=this,i=r.constructor,o=r.s,s=(t=new i(t)).s;if(!t.c[0])throw Error(O);return r.s=t.s=1,e=t.cmp(r)==1,r.s=o,t.s=s,e?new i(r):(o=i.DP,s=i.RM,i.DP=i.RM=0,r=r.div(t),i.DP=o,i.RM=s,this.minus(r.times(t)))};h.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};h.plus=h.add=function(t){var e,r,i,o=this,s=o.constructor;if(t=new s(t),o.s!=t.s)return t.s=-t.s,o.minus(t);var l=o.e,n=o.c,a=t.e,c=t.c;if(!n[0]||!c[0])return c[0]||(n[0]?t=new s(o):t.s=o.s),t;if(n=n.slice(),e=l-a){for(e>0?(a=l,i=c):(e=-e,i=n),i.reverse();e--;)i.push(0);i.reverse()}for(n.length-c.length<0&&(i=c,c=n,n=i),e=c.length,r=0;e;n[e]%=10)r=(n[--e]=n[e]+c[e]+r)/10|0;for(r&&(n.unshift(r),++a),e=n.length;n[--e]===0;)n.pop();return t.c=n,t.e=a,t};h.pow=function(t){var e=this,r=new e.constructor("1"),i=r,o=t<0;if(t!==~~t||t<-F||t>F)throw Error(T+"exponent");for(o&&(t=-t);t&1&&(i=i.times(e)),t>>=1,!!t;)e=e.times(e);return o?r.div(i):i};h.prec=function(t,e){if(t!==~~t||t<1||t>D)throw Error(T+"precision");return A(new this.constructor(this),t,e)};h.round=function(t,e){if(t===p)t=0;else if(t!==~~t||t<-D||t>D)throw Error(I);return A(new this.constructor(this),t+this.e+1,e)};h.sqrt=function(){var t,e,r,i=this,o=i.constructor,s=i.s,l=i.e,n=new o("0.5");if(!i.c[0])return new o(i);if(s<0)throw Error($+"No square root");s=Math.sqrt(i+""),s===0||s===1/0?(e=i.c.join(""),e.length+l&1||(e+="0"),s=Math.sqrt(e),l=((l+1)/2|0)-(l<0||l&1),t=new o((s==1/0?"5e":(s=s.toExponential()).slice(0,s.indexOf("e")+1))+l)):t=new o(s+""),l=t.e+(o.DP+=4);do r=t,t=n.times(r.plus(i.div(r)));while(r.c.slice(0,l).join("")!==t.c.slice(0,l).join(""));return A(t,(o.DP-=4)+t.e+1,o.RM)};h.times=h.mul=function(t){var e,r=this,i=r.constructor,o=r.c,s=(t=new i(t)).c,l=o.length,n=s.length,a=r.e,c=t.e;if(t.s=r.s==t.s?1:-1,!o[0]||!s[0])return t.c=[t.e=0],t;for(t.e=a+c,l<n&&(e=o,o=s,s=e,c=l,l=n,n=c),e=new Array(c=l+n);c--;)e[c]=0;for(a=n;a--;){for(n=0,c=l+a;c>a;)n=e[c]+s[a]*o[c-a-1]+n,e[c--]=n%10,n=n/10|0;e[c]=n}for(n?++t.e:e.shift(),a=e.length;!e[--a];)e.pop();return t.c=e,t};h.toExponential=function(t,e){var r=this,i=r.c[0];if(t!==p){if(t!==~~t||t<0||t>D)throw Error(I);for(r=A(new r.constructor(r),++t,e);r.c.length<t;)r.c.push(0)}return B(r,!0,!!i)};h.toFixed=function(t,e){var r=this,i=r.c[0];if(t!==p){if(t!==~~t||t<0||t>D)throw Error(I);for(r=A(new r.constructor(r),t+r.e+1,e),t=t+r.e+1;r.c.length<t;)r.c.push(0)}return B(r,!1,!!i)};h[Symbol.for("nodejs.util.inspect.custom")]=h.toJSON=h.toString=function(){var t=this,e=t.constructor;return B(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};h.toNumber=function(){var t=Number(B(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error($+"Imprecise conversion");return t};h.toPrecision=function(t,e){var r=this,i=r.constructor,o=r.c[0];if(t!==p){if(t!==~~t||t<1||t>D)throw Error(T+"precision");for(r=A(new i(r),t,e);r.c.length<t;)r.c.push(0)}return B(r,t<=r.e||r.e<=i.NE||r.e>=i.PE,!!o)};h.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error($+"valueOf disallowed");return B(t,t.e<=e.NE||t.e>=e.PE,!0)};var G=_(),b=G;const f=new Web3(window.ethereum),N=async(t,e,r)=>{const o=await(await fetch(e)).json();return new t.eth.Contract(o.abi,r)},W=async(t=null)=>{const e=t||P(),i=await(await N(f,d("Moret.json"),V)).methods.getVolatilityChain(String(e)).call();return await N(f,d("VolatilityChain.json"),i)},et=async(t=null)=>{const e=t||P(),i=await(await W(e)).methods.queryPrice().call();return`$${b(f.utils.fromWei(i)).round(2).toNumber()}`},rt=async(t=null,e)=>{const r=t||P(),o=await(await W(r)).methods.queryPrice().call(),s=b(f.utils.fromWei(o)).toNumber(),l=[.6,.7,.8,.85,.9,.95,1,1.05,1.1,1.15,1.2,1.3,1.4],n=50,a=[];for(let c of l){let g=b(s).times(c).div(n).round().times(n).toNumber(),u=await Q(r,g,e);a.push(`${g} | ${u}`)}return a},Q=async(t=null,e,r)=>{const i=t||P(),s=await(await W(i)).methods.queryPrice().call(),l=b(f.utils.fromWei(s)).toNumber(),n=b(e).div(l).times(100).round().toNumber();return n===100?"ATM":n>100?`${(n-100).toString()}${r?"% ITM":"% OTM"}`:`${(100-n).toString()}${r?"% OTM":"% ITM"}`},ot=async(t=null)=>{const e=t||P(),r=await W(e),i=[1,7,30];let o=[];for(let s of i){const l=b(s).times(86400).round().toNumber(),n=b(s).div(365),a=await r.methods.queryVol(l).call(),c=`${b(f.utils.fromWei(a)).div(n.sqrt()).toNumber().toLocaleString(void 0,{style:"percent",minimumFractionDigits:0})} RV`,g=b(s).eq(1)?"":"s";o.push(`${s} Day${g} | ${c}`)}return o},y=async(t=null,e)=>{const r=t||P(),i=await N(f,d("Moret.json"),V),o=b(e).times(86400).round().toNumber();try{const s=await i.methods.getVolatilityToken(r,o).call();return await(await N(f,d("VolatilityToken.json"),s)).methods.symbol().call()}catch{return""}},it=async(t=null,e=null,r,i,o,s,l,n)=>{try{const w=t||P(),m=await N(f,d("Exchange.json"),R),j=Math.floor(n*86400),C=await U(w);var a=0 .toString(16),c,g,u=0,v=0;for(let x=0;x<C.length;x++){const E=C[x],M=await m.methods.queryOption(E,j,f.utils.toWei(s.toString(),"ether"),f.utils.toWei(l.toString(),"ether"),i?0:1,r?0:1,!1).call(),S=parseFloat(f.utils.fromWei(f.utils.toBN(M[0])));(parseInt(a,16)==0||r&&S<c||!r&&S>c)&&(c=S,g=parseFloat(f.utils.fromWei(f.utils.toBN(M[1]))),v=parseFloat(f.utils.fromWei(f.utils.toBN(M[2]))),u=parseFloat(f.utils.fromWei(f.utils.toBN(M[3]))),a=E)}if(u==0||v==0)throw"There is no available liquidity pool.";var k="USDC",q="USDC";if(o==0||(o==1?(c=c/v,g=g/v,k=q=e):o==2&&(c=c/u,k=await y(w,n))),e)return{volatility:u.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0}),premium:`${b(c).round(5)}${k}`,collateral:`${b(g).round(2)}${q}`}}catch(w){return w.message}},U=async(t=null)=>{const e=t||P(),i=await(await N(f,d("Moret.json"),V)).methods.broker().call();return await(await N(f,d("MoretBroker.json"),i)).methods.getAllPools(e).call()},nt=async(t=null)=>{const e=t||P(),i=await(await N(f,d("Exchange.json"),R)).methods.vault().call(),o=await N(f,d("OptionVault.json"),i),s=await U(e);var l=0,n=0;for(let c=0;c<s.length;c++){const g=s[c],u=await o.methods.calcCapital(g,!1,!1).call(),v=await o.methods.calcCapital(g,!0,!1).call();l=l+parseFloat(f.utils.fromWei(u)),n=n+parseFloat(f.utils.fromWei(v))}const a=Math.max(0,1-n/l);return{gross:`$${l/1e3}K`,perc:a.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0})}};export{b as B,y as a,rt as b,Q as c,ot as d,it as e,nt as f,et as g,f as w};
