import{v as y,C as v,t as d,y as h,a as x,s as b,d as T,D as g,E as w,F as f,o as q}from"./main.ca00b66d.js";import u from"./component.dropdownSelect.69555ea6.js";import C from"./component.percentageBar.6a9f6ee9.js";import m from"./component.toggleSwitches.d31686b5.js";import S from"./component.tradingviewWidget.39e7020b.js";var N={globals:{elem:document.querySelector(".trader-volatility"),init:!0,execIntervalId:null},init(){this.optAmount(),this.optExpiry(),this.buttonTrade(),this.transactionsTable();const e={childList:!0,attributes:!0,attributeFilter:["sidenav-activechange","sidenav-refreshprice"]};new MutationObserver(i=>{console.log("sidenav refreshed from Trader Volatility!");for(let n of i)if(n.type==="attributes")switch(n.attributeName){case"sidenav-activechange":S.createGraph(),this.optPrice(),this.liquidityPool();break;case"sidenav-refreshprice":this.optPrice(),document.querySelector(".overlay-popup")&&this.optPrice(!0);break}this.globals.init=!1}).observe(this.globals.elem.querySelector(".sidenav"),e);const a={attributes:!0,attributeFilter:["ts-activechanged","dds-updated"]},o=new MutationObserver(i=>{for(let n of i)if(n.attributeName==="ts-activechanged"||n.attributeName==="dds-updated"){if(n.target.classList.contains("opt-callput")){const l=document.querySelector(".opt-strike");parseInt(l.getAttribute("dds-selected"))===0&&u.valueFromInputField(l,l.querySelector(".ds-value1").textContent),this.optStrike()}this.optPrice()}});o.observe(document.querySelector(".opt-buysell"),a),o.observe(document.querySelector(".opt-expiry"),a);const r=new MutationObserver(i=>{r.disconnect()});r.observe(document.querySelector(".opt-expiry .ds-value1"),{childList:!0})},optAmount(){document.querySelector("input[name='opt-amount']").addEventListener("keydown",t=>{t.keyCode==13&&this.optPrice()},!1)},optExpiry(){u.createListItems(document.querySelector(".opt-expiry"),y())},optPrice(e=!1){new Promise((t,a)=>{setTimeout(()=>{t({amount:this.getAmountValue(),expiry:this.getExpiryValue()})},this.globals.init?2e3:500)}).then(async t=>{const a=await v(null,d(),this.isBuy(),t.amount,t.expiry);e?(document.querySelector(".overlay-popup .to-volatility span").textContent=a.volatility,document.querySelector(".overlay-popup .to-vol-premium span").textContent=a.volpremium):(document.querySelector(".opt-price .info-volatility").textContent=a.volatility,document.querySelector(".opt-price .info-vol-premium").textContent=a.volpremium)}).catch(t=>console.warn(t))},async liquidityPool(){const e=await h();document.querySelector(".liquidity-pool .pb-price-end").textContent=e.gross,document.querySelector(".liquidity-pool .pb-price-from").textContent=e.utilized,document.querySelector(".liquidity-pool .pb-text-value").textContent=e.text,C.progressBar(document.querySelector(".liquidity-pool"),e.perc)},buttonTrade(){document.querySelector(".opt-price .btn").addEventListener("click",async t=>{t.preventDefault();const a=[{name:`${m.getActiveItem(document.querySelector(".opt-buysell"))}:`,span:`volatility token on ${d()} - ${x()}`,class:"to-buy"},{name:"Expiry:",span:"-",class:"to-expiry"},{name:"Dollar Amount:",span:this.getAmountValue(),class:"to-amount"},{name:"Implied Volatility:",span:"-",class:"to-volatility"},{name:"Volatility Token Amount:",span:"-",class:"to-vol-premium"}];b("Trade overview",T(a,"tradeoverview")),u.insertValues(document.querySelector(".opt-expiry"),document.querySelector(".overlay-popup .to-expiry span"),!0),this.optPrice(!0),setTimeout(()=>this.executeTrade(),500)})},executeTrade(){const e=document.createElement("div");e.className="executetrade",document.querySelector(".overlay-popup .op-content").appendChild(e);const t=document.createElement("a");t.setAttribute("href","#"),t.className="btn btn-blue",t.textContent="Execute",e.appendChild(t),t.addEventListener("click",async a=>{a.preventDefault(),t.remove();const o=document.createElement("div");o.className="await-approval",o.textContent="Awaiting for allowance approval";const r=document.createElement("div");r.className="await-approval-timer",r.textContent="00:00",o.appendChild(r),e.appendChild(o);const i=document.createElement("div");i.className="await-trade",i.textContent="Awaiting for transaction";const n=document.createElement("div");n.className="await-trade-timer",n.textContent="00:00",i.appendChild(n),e.appendChild(i),this.executeTradeTimer(r);const l="Warning: Transaction has failed.";await g(null,this.isBuy(),this.getAmountValue(),this.getExpiryValue())==="failure"?this.executeTradeFailure(e,l):(o.classList.add("await-active"),o.textContent="Allowance approved.",r.remove(),this.clearTradeTimer(),setTimeout(async()=>{this.executeTradeTimer(n);const p=await w(null,this.isBuy(),this.getAmountValue(),this.getExpiryValue());if(p==="")this.executeTradeFailure(e,l);else{i.classList.add("await-active"),i.textContent="Transaction mined.",n.remove(),this.clearTradeTimer();const c=document.createElement("div");c.className="approve-trade-link";const s=document.createElement("a");s.setAttribute("href",p),s.setAttribute("target","_blank"),s.className="link-arrow",s.textContent="View on Polygonscan",c.appendChild(s),e.appendChild(c)}},500))},!1)},executeTradeFailure(e,t){const a=document.createElement("div");a.className="await-failure";const o=document.createElement("div");o.className="warning-icon";const r=document.createElement("div");r.className="warning-text",r.textContent=t,a.appendChild(o),a.appendChild(r),e.appendChild(a)},executeTradeTimer(e){const t=o=>o>9?o:`0${o}`;let a=0;this.globals.execIntervalId=setInterval(()=>{a++,a>120?(this.executeTradeFailure(document.querySelector(".overlay-popup .executetrade"),"Warning: Transaction has taking longer than normal to be mined. You can close the window and try to trade again."),this.clearTradeTimer()):e.textContent=`${t(parseInt(a/60))}:${t(a%60)}`},1e3)},clearTradeTimer(){clearInterval(this.globals.execIntervalId),this.globals.execIntervalId=null,console.log("clearTradeTimer()")},transactionsTable(){f(null).then(e=>{const t=document.querySelector(".transactions .comp-dynamic-table"),a=[];e.forEach(o=>{a.push([o.Token,o.Tenor,o.Amount,o.ImpliedVolatility])}),q.setDynamic(t,a)})},isBuy(){return m.getActiveItem(document.querySelector(".opt-buysell")).toLowerCase()==="buy"},getAmountValue(){return document.querySelector("input[name='opt-amount']").value},getExpiryValue(){return document.querySelector(".opt-expiry .ds-value1").textContent.replace("Days","").replace("Day","").trim()}};export{N as default};
