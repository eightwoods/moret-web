import{t as k,g as p,e as F,m as Y,a as S}from"./main.4663baeb.js";var it=20,at=1,W=1e6,Z=1e6,st=-7,ct=21,lt=!1,_="[big.js] ",y=_+"Invalid ",L=y+"decimal places",ut=y+"rounding mode",Q=_+"Division by zero",d={},A=void 0,ft=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function tt(){function t(e){var o=this;if(!(o instanceof t))return e===A?tt():new t(e);if(e instanceof t)o.s=e.s,o.e=e.e,o.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(y+"value");e=e===0&&1/e<0?"-0":String(e)}ht(o,e)}o.constructor=t}return t.prototype=d,t.DP=it,t.RM=at,t.NE=st,t.PE=ct,t.strict=lt,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function ht(t,e){var o,r,n;if(!ft.test(e))throw Error(y+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(o=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(o<0&&(o=r),o+=+e.slice(r+1),e=e.substring(0,r)):o<0&&(o=e.length),n=e.length,r=0;r<n&&e.charAt(r)=="0";)++r;if(r==n)t.c=[t.e=0];else{for(;n>0&&e.charAt(--n)=="0";);for(t.e=o-r-1,t.c=[],o=0;r<=n;)t.c[o++]=+e.charAt(r++)}return t}function V(t,e,o,r){var n=t.c;if(o===A&&(o=t.constructor.RM),o!==0&&o!==1&&o!==2&&o!==3)throw Error(ut);if(e<1)r=o===3&&(r||!!n[0])||e===0&&(o===1&&n[0]>=5||o===2&&(n[0]>5||n[0]===5&&(r||n[1]!==A))),n.length=1,r?(t.e=t.e-e+1,n[0]=1):n[0]=t.e=0;else if(e<n.length){if(r=o===1&&n[e]>=5||o===2&&(n[e]>5||n[e]===5&&(r||n[e+1]!==A||n[e-1]&1))||o===3&&(r||!!n[0]),n.length=e--,r)for(;++n[e]>9;)n[e]=0,e--||(++t.e,n.unshift(1));for(e=n.length;!n[--e];)n.pop()}return t}function B(t,e,o){var r=t.e,n=t.c.join(""),i=n.length;if(e)n=n.charAt(0)+(i>1?"."+n.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)n="0"+n;n="0."+n}else if(r>0)if(++r>i)for(r-=i;r--;)n+="0";else r<i&&(n=n.slice(0,r)+"."+n.slice(r));else i>1&&(n=n.charAt(0)+"."+n.slice(1));return t.s<0&&o?"-"+n:n}d.abs=function(){var t=new this.constructor(this);return t.s=1,t};d.cmp=function(t){var e,o=this,r=o.c,n=(t=new o.constructor(t)).c,i=o.s,l=t.s,a=o.e,u=t.e;if(!r[0]||!n[0])return r[0]?i:n[0]?-l:0;if(i!=l)return i;if(e=i<0,a!=u)return a>u^e?1:-1;for(l=(a=r.length)<(u=n.length)?a:u,i=-1;++i<l;)if(r[i]!=n[i])return r[i]>n[i]^e?1:-1;return a==u?0:a>u^e?1:-1};d.div=function(t){var e=this,o=e.constructor,r=e.c,n=(t=new o(t)).c,i=e.s==t.s?1:-1,l=o.DP;if(l!==~~l||l<0||l>W)throw Error(L);if(!n[0])throw Error(Q);if(!r[0])return t.s=i,t.c=[t.e=0],t;var a,u,s,h,f,g=n.slice(),N=a=n.length,T=r.length,m=r.slice(0,a),w=m.length,M=t,b=M.c=[],E=0,x=l+(M.e=e.e-t.e)+1;for(M.s=i,i=x<0?0:x,g.unshift(0);w++<a;)m.push(0);do{for(s=0;s<10;s++){if(a!=(w=m.length))h=a>w?1:-1;else for(f=-1,h=0;++f<a;)if(n[f]!=m[f]){h=n[f]>m[f]?1:-1;break}if(h<0){for(u=w==a?n:g;w;){if(m[--w]<u[w]){for(f=w;f&&!m[--f];)m[f]=9;--m[f],m[w]+=10}m[w]-=u[w]}for(;!m[0];)m.shift()}else break}b[E++]=h?s:++s,m[0]&&h?m[w]=r[N]||0:m=[r[N]]}while((N++<T||m[0]!==A)&&i--);return!b[0]&&E!=1&&(b.shift(),M.e--,x--),E>x&&V(M,x,o.RM,m[0]!==A),M};d.eq=function(t){return this.cmp(t)===0};d.gt=function(t){return this.cmp(t)>0};d.gte=function(t){return this.cmp(t)>-1};d.lt=function(t){return this.cmp(t)<0};d.lte=function(t){return this.cmp(t)<1};d.minus=d.sub=function(t){var e,o,r,n,i=this,l=i.constructor,a=i.s,u=(t=new l(t)).s;if(a!=u)return t.s=-u,i.plus(t);var s=i.c.slice(),h=i.e,f=t.c,g=t.e;if(!s[0]||!f[0])return f[0]?t.s=-u:s[0]?t=new l(i):t.s=1,t;if(a=h-g){for((n=a<0)?(a=-a,r=s):(g=h,r=f),r.reverse(),u=a;u--;)r.push(0);r.reverse()}else for(o=((n=s.length<f.length)?s:f).length,a=u=0;u<o;u++)if(s[u]!=f[u]){n=s[u]<f[u];break}if(n&&(r=s,s=f,f=r,t.s=-t.s),(u=(o=f.length)-(e=s.length))>0)for(;u--;)s[e++]=0;for(u=e;o>a;){if(s[--o]<f[o]){for(e=o;e&&!s[--e];)s[e]=9;--s[e],s[o]+=10}s[o]-=f[o]}for(;s[--u]===0;)s.pop();for(;s[0]===0;)s.shift(),--g;return s[0]||(t.s=1,s=[g=0]),t.c=s,t.e=g,t};d.mod=function(t){var e,o=this,r=o.constructor,n=o.s,i=(t=new r(t)).s;if(!t.c[0])throw Error(Q);return o.s=t.s=1,e=t.cmp(o)==1,o.s=n,t.s=i,e?new r(o):(n=r.DP,i=r.RM,r.DP=r.RM=0,o=o.div(t),r.DP=n,r.RM=i,this.minus(o.times(t)))};d.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};d.plus=d.add=function(t){var e,o,r,n=this,i=n.constructor;if(t=new i(t),n.s!=t.s)return t.s=-t.s,n.minus(t);var l=n.e,a=n.c,u=t.e,s=t.c;if(!a[0]||!s[0])return s[0]||(a[0]?t=new i(n):t.s=n.s),t;if(a=a.slice(),e=l-u){for(e>0?(u=l,r=s):(e=-e,r=a),r.reverse();e--;)r.push(0);r.reverse()}for(a.length-s.length<0&&(r=s,s=a,a=r),e=s.length,o=0;e;a[e]%=10)o=(a[--e]=a[e]+s[e]+o)/10|0;for(o&&(a.unshift(o),++u),e=a.length;a[--e]===0;)a.pop();return t.c=a,t.e=u,t};d.pow=function(t){var e=this,o=new e.constructor("1"),r=o,n=t<0;if(t!==~~t||t<-Z||t>Z)throw Error(y+"exponent");for(n&&(t=-t);t&1&&(r=r.times(e)),t>>=1,!!t;)e=e.times(e);return n?o.div(r):r};d.prec=function(t,e){if(t!==~~t||t<1||t>W)throw Error(y+"precision");return V(new this.constructor(this),t,e)};d.round=function(t,e){if(t===A)t=0;else if(t!==~~t||t<-W||t>W)throw Error(L);return V(new this.constructor(this),t+this.e+1,e)};d.sqrt=function(){var t,e,o,r=this,n=r.constructor,i=r.s,l=r.e,a=new n("0.5");if(!r.c[0])return new n(r);if(i<0)throw Error(_+"No square root");i=Math.sqrt(r+""),i===0||i===1/0?(e=r.c.join(""),e.length+l&1||(e+="0"),i=Math.sqrt(e),l=((l+1)/2|0)-(l<0||l&1),t=new n((i==1/0?"5e":(i=i.toExponential()).slice(0,i.indexOf("e")+1))+l)):t=new n(i+""),l=t.e+(n.DP+=4);do o=t,t=a.times(o.plus(r.div(o)));while(o.c.slice(0,l).join("")!==t.c.slice(0,l).join(""));return V(t,(n.DP-=4)+t.e+1,n.RM)};d.times=d.mul=function(t){var e,o=this,r=o.constructor,n=o.c,i=(t=new r(t)).c,l=n.length,a=i.length,u=o.e,s=t.e;if(t.s=o.s==t.s?1:-1,!n[0]||!i[0])return t.c=[t.e=0],t;for(t.e=u+s,l<a&&(e=n,n=i,i=e,s=l,l=a,a=s),e=new Array(s=l+a);s--;)e[s]=0;for(u=a;u--;){for(a=0,s=l+u;s>u;)a=e[s]+i[u]*n[s-u-1]+a,e[s--]=a%10,a=a/10|0;e[s]=a}for(a?++t.e:e.shift(),u=e.length;!e[--u];)e.pop();return t.c=e,t};d.toExponential=function(t,e){var o=this,r=o.c[0];if(t!==A){if(t!==~~t||t<0||t>W)throw Error(L);for(o=V(new o.constructor(o),++t,e);o.c.length<t;)o.c.push(0)}return B(o,!0,!!r)};d.toFixed=function(t,e){var o=this,r=o.c[0];if(t!==A){if(t!==~~t||t<0||t>W)throw Error(L);for(o=V(new o.constructor(o),t+o.e+1,e),t=t+o.e+1;o.c.length<t;)o.c.push(0)}return B(o,!1,!!r)};d[Symbol.for("nodejs.util.inspect.custom")]=d.toJSON=d.toString=function(){var t=this,e=t.constructor;return B(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};d.toNumber=function(){var t=Number(B(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(_+"Imprecise conversion");return t};d.toPrecision=function(t,e){var o=this,r=o.constructor,n=o.c[0];if(t!==A){if(t!==~~t||t<1||t>W)throw Error(y+"precision");for(o=V(new r(o),t,e);o.c.length<t;)o.c.push(0)}return B(o,t<=o.e||o.e<=r.NE||o.e>=r.PE,!!n)};d.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(_+"valueOf disallowed");return B(t,t.e<=e.NE||t.e>=e.PE,!0)};var mt=tt(),P=mt;function O(t){var e=0;if(t>=8)e=1;else if(t<=-8)e=0;else{for(var o=0;o<100;o++)e+=Math.pow(t,2*o+1)/gt(2*o+1);e*=Math.pow(Math.E,-.5*Math.pow(t,2)),e/=Math.sqrt(2*Math.PI),e+=.5}return e}function gt(t){for(var e=1,o=t;o>1;o-=2)e*=o;return e}function wt(t,e,o,r,n,i){var l=null,a=(n*o+Math.pow(r,2)*o/2-Math.log(e/t))/(r*Math.sqrt(o));return i==="call"?l=t*O(a)-e*Math.pow(Math.E,-1*n*o)*O(a-r*Math.sqrt(o)):l=e*Math.pow(Math.E,-1*n*o)*O(r*Math.sqrt(o)-a)-t*O(-a),l}function dt(t,e,o,r,n){var i=(n*o+Math.pow(r,2)*o/2-Math.log(e/t))/(r*Math.sqrt(o));return i}var pt={blackScholes:wt,stdNormCDF:O,getW:dt},j=pt;function U(t){return Math.pow(Math.E,-1*Math.pow(t,2)/2)/Math.sqrt(2*Math.PI)}function vt(t,e,o,r,n,i){return i==="call"?et(t,e,o,r,n):bt(t,e,o,r,n)}function et(t,e,o,r,n){var i=j.getW(t,e,o,r,n),l=null;return isFinite(i)?l=j.stdNormCDF(i):l=t>e?1:0,l}function bt(t,e,o,r,n){var i=et(t,e,o,r,n)-1;return i==-1&&e==t?0:i}function Mt(t,e,o,r,n,i,l){return l=l||100,i==="call"?Nt(t,e,o,r,n)/l:Tt(t,e,o,r,n)/l}function Nt(t,e,o,r,n){var i=j.getW(t,e,o,r,n);return isNaN(i)?0:e*o*Math.pow(Math.E,-1*n*o)*j.stdNormCDF(i-r*Math.sqrt(o))}function Tt(t,e,o,r,n){var i=j.getW(t,e,o,r,n);return isNaN(i)?0:-1*e*o*Math.pow(Math.E,-1*n*o)*j.stdNormCDF(r*Math.sqrt(o)-i)}function Ct(t,e,o,r,n){var i=j.getW(t,e,o,r,n);return isFinite(i)?t*Math.sqrt(o)*U(i)/100:0}function Et(t,e,o,r,n,i,l){return l=l||365,i==="call"?kt(t,e,o,r,n)/l:Pt(t,e,o,r,n)/l}function kt(t,e,o,r,n){var i=j.getW(t,e,o,r,n);return isFinite(i)?-1*r*t*U(i)/(2*Math.sqrt(o))-e*n*Math.pow(Math.E,-1*n*o)*j.stdNormCDF(i-r*Math.sqrt(o)):0}function Pt(t,e,o,r,n){var i=j.getW(t,e,o,r,n);return isFinite(i)?-1*r*t*U(i)/(2*Math.sqrt(o))+e*n*Math.pow(Math.E,-1*n*o)*j.stdNormCDF(r*Math.sqrt(o)-i):0}function qt(t,e,o,r,n){var i=j.getW(t,e,o,r,n);return isFinite(i)?U(i)/(t*r*Math.sqrt(o)):0}var R={getDelta:vt,getVega:Ct,getGamma:qt,getTheta:Et,getRho:Mt};const c=new Web3(window.ethereum),v=async(t,e,o)=>{const n=await(await fetch(e)).json();return new t.eth.Contract(n.abi,o)},$=async(t=null)=>{const e=t||k(),r=await(await v(c,p("Moret.json"),S)).methods.getVolatilityChain(String(e)).call();return await v(c,p("VolatilityChain.json"),r)},Dt=async(t=null)=>{const e=t||k(),r=await(await $(e)).methods.queryPrice().call();return`$${P(c.utils.fromWei(r)).round(2).toNumber()}`},Wt=async(t=null,e)=>{const o=t||k(),n=await(await $(o)).methods.queryPrice().call(),i=P(c.utils.fromWei(n)).toNumber(),l=[.6,.7,.8,.85,.9,.95,1,1.05,1.1,1.15,1.2,1.3,1.4],a=50,u=[];for(let s of l){let h=P(i).times(s).div(a).round().times(a).toNumber(),f=await xt(o,h,e);u.push(`${h} | ${f}`)}return u},xt=async(t=null,e,o)=>{const r=t||k(),i=await(await $(r)).methods.queryPrice().call(),l=P(c.utils.fromWei(i)).toNumber(),a=P(e).div(l).times(100).round().toNumber();return a===100?"ATM":a>100?`${(a-100).toString()}${o?"% OTM":"% ITM"}`:`${(100-a).toString()}${o?"% ITM":"% OTM"}`},St=async(t=null)=>{const e=t||k(),o=await $(e),r=[1,7,30];let n=[];for(let i of r){const l=P(i).times(86400).round().toNumber(),a=P(i).div(365),u=await o.methods.queryVol(l).call(),s=`${P(c.utils.fromWei(u)).div(a.sqrt()).toNumber().toLocaleString(void 0,{style:"percent",minimumFractionDigits:0})} RV`,h=P(i).eq(1)?"":"s";n.push(`${i} Day${h} | ${s}`)}return n},jt=async(t=null,e)=>{const o=t||k(),r=await v(c,p("Moret.json"),S),n=P(e).times(86400).round().toNumber();try{const i=await r.methods.getVolatilityToken(o,n).call();return await(await v(c,p("VolatilityToken.json"),i)).methods.symbol().call()}catch{return""}},ot=async(t=null,e=null,o,r,n,i,l,a)=>{try{if(i<=0)throw"Strike not set correctly.";if(a<=0)throw"Expiry not set correctly";const m=t||k(),w=await v(c,p("Exchange.json"),F),M=Math.floor(a*86400),b=await rt(m);var u=0 .toString(16),s,h,f=0,g=0;for(let E=0;E<b.length;E++){const x=b[E],q=await w.methods.queryOption(x,M,c.utils.toWei(i.toString(),"ether"),c.utils.toWei(l.toString(),"ether"),r?0:1,o?0:1,!1).call(),C=parseFloat(c.utils.fromWei(c.utils.toBN(q[0])));(parseInt(u,16)==0||o&&C<s||!o&&C>s)&&(s=C,h=parseFloat(c.utils.fromWei(c.utils.toBN(q[1]))),g=parseFloat(c.utils.fromWei(c.utils.toBN(q[2]))),f=parseFloat(c.utils.fromWei(c.utils.toBN(q[3]))),u=x)}if(f==0||g==0)throw"There is no available liquidity pool.";var N="USDC",T="USDC";return n==0||(n==1?(s=s/g,h=h/g,N=T=e):n==2&&(s=s/f,N=await jt(m,a))),e?{volatility:f.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0}),premium:`${P(s).round(5)}${N}`,collateral:`${P(h).round(2)}${T}`,error:""}:{volatility:f,premium:s,collateral:h,pool:u,error:""}}catch(m){return{volatility:"-",premium:"-",collateral:"-",error:m.message}}},rt=async(t=null)=>{const e=t||k(),r=await(await v(c,p("Moret.json"),S)).methods.broker().call();return await(await v(c,p("MoretBroker.json"),r)).methods.getAllPools(e).call()},yt=async(t=null)=>{const e=t||k(),r=await(await v(c,p("Exchange.json"),F)).methods.vault().call(),n=await v(c,p("OptionVault.json"),r),i=await rt(e);var l=0,a=0;for(let h=0;h<i.length;h++){const f=i[h],g=await n.methods.calcCapital(f,!1,!1).call(),N=await n.methods.calcCapital(f,!0,!1).call();l=l+parseFloat(c.utils.fromWei(g)),a=a+parseFloat(c.utils.fromWei(N))}const u=l-a,s=Math.max(0,1-a/l);return{gross:`$${(l/1e3).toFixed(3)}K`,utilized:`$${(u/1e3).toFixed(3)}K`,perc:s*100,text:s.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0})}},Vt=async(t=null,e,o,r,n,i,l)=>{const a=t||k(),u=await v(c,p("Moret.json"),S),s=await ot(a,null,e,o,r,n,i,l);console.log(s);const h=await u.methods.funding().call(),f=Math.floor(l*86400);var g=r==0?h:a;if(r==2)try{g=await u.methods.getVolatilityToken(a,f).call()}catch{console.log(`no vol token exists for ${l.toString()}`)}const N=await v(c,p("ERC20.json"),g),T=await v(c,p("ERC20.json"),r==1?a:h);var m=await ethereum.request({method:"eth_requestAccounts"}),w=c.utils.toChecksumAddress(m[0]);try{await G(N,w,F,s.premium),await G(T,w,F,s.collateral)}catch(M){return console.warn(M),"failure"}},G=async(t,e,o,r)=>{var n=await t.methods.allowance(e,o).call();const i=await t.methods.decimals().call();if(c.utils.toBN(c.utils.toWei(r.toString())).mul(c.utils.toBN(10).pow(c.utils.toBN(18-Number(i)))).gt(c.utils.toBN(n))){var a=await c.eth.getGasPrice(),u=await t.methods.approve(o,Y).estimateGas({from:e,gasPrice:a});u=Number(c.utils.toBN(u).mul(c.utils.toBN(Number(150))).div(c.utils.toBN(Number(100))));var s=await c.eth.getTransactionCount(e);await t.methods.approve(o,Y).send({from:e,gas:u,gasPrice:a,nonce:s})}},Bt=async(t=null,e,o,r,n,i,l)=>{const a=t||k(),u=await ot(a,null,e,o,r,n,i,l),s=c.utils.toChecksumAddress(u.pool),h=Math.floor(l*86400);var f=await ethereum.request({method:"eth_requestAccounts"}),g=c.utils.toChecksumAddress(f[0]);try{const w=await v(c,p("Exchange.json"),F);var N=await c.eth.getGasPrice(),T=await w.methods.tradeOption(s,h,c.utils.toWei(n.toString()),c.utils.toWei(i.toString()),o?0:1,e?0:1,r).estimateGas({from:g,gasPrice:N});T=Number(c.utils.toBN(T).mul(c.utils.toBN(Number(150))).div(c.utils.toBN(Number(100))));var m=await c.eth.getTransactionCount(g);let M=null;return await w.methods.tradeOption(s,h,c.utils.toWei(n.toString()),c.utils.toWei(i.toString()),o?0:1,e?0:1,r).send({from:g,gas:T,gasPrice:N,nonce:m}).on("transactionHash",b=>{M=`https://polygonscan.com/tx/${b}`}).on("error",function(b,E){return""}),M}catch(w){return console.warn(w),""}},$t=async(t=null,e=9e3,o=null)=>{const r=t||k(),n=await v(c,p("Exchange.json"),F),i=await n.methods.vault().call(),l=await v(c,p("OptionVault.json"),i);var a=await ethereum.request({method:"eth_requestAccounts"}),u=c.utils.toChecksumAddress(a[0]);const s=await $(r),h=await s.methods.queryPrice().call(),f=parseFloat(c.utils.fromWei(h)),g=await c.eth.getBlockNumber(),N=(o||g)-e;let T=null;await n.getPastEvents("NewOption",{filter:{_purchaser:u,_underlying:r},fromBlock:N,toBlock:o||g},async(w,M)=>{T=M});let m=[];for(let w=0;w<T.length;w++){const M=T[w].returnValues._optionId,b=await l.methods.getOption(M).call(),E=parseFloat(c.utils.fromWei(b.strike)),x=parseFloat(c.utils.fromWei(b.amount)),q=Math.floor((b.maturity*1e3-Date.now())/1e3),C=q/(3600*24*365),D=q<=0?0:await s.methods.queryVol(q).call();m.push({Type:b.poType==0?"Call":"Put",BS:b.side==0?"Buy":"Sell",Expiry:new Date(b.maturity*1e3).toLocaleString(),Strike:E.toFixed(0),Amount:x.toFixed(3),Delta:(C<=0?0:R.getDelta(f,E,C,parseFloat(c.utils.fromWei(D))/Math.sqrt(C),0,b.poType==0?"call":"put")*(b.side==0?1:-1)).toFixed(3),Gamma:(C<=0?0:R.getGamma(f,E,C,parseFloat(c.utils.fromWei(D))/Math.sqrt(C),0)*(b.side==0?1:-1)).toFixed(3),Vega:(C<=0?0:R.getVega(f,E,C,parseFloat(c.utils.fromWei(D))/Math.sqrt(C),0)*(b.side==0?1:-1)).toFixed(3),Theta:(C<=0?0:R.getTheta(f,E,C,parseFloat(c.utils.fromWei(D))/Math.sqrt(C),0,b.poType==0?"call":"put")*(b.side==0?1:-1)).toFixed(3)})}return m},nt=async(t=null,e=null,o,r,n)=>{try{if(n<=0)throw"Expiry not set correctly";const s=t||k(),h=await v(c,p("Exchange.json"),F),f=await $(s),g=Math.floor(n*86400),N=n/365,T=await f.methods.queryVol(g).call(),m=await f.methods.queryPrice().call(),w=r/parseFloat(c.utils.fromWei(T))/parseFloat(c.utils.fromWei(m))/.4,M=await At(s);var i,l,a=0;const E=await(await v(c,p("Moret.json"),S)).methods.getVolatilityToken(s,g).call(),q=await(await v(c,p("VolatilityToken.json"),E)).methods.symbol().call(),C="USDC";var u=0 .toString(16);if(M.length==0)throw"There is no available pool to trade volatility tokens with.";for(let D=0;D<M.length;D++){const z=M[D],J=await h.methods.queryOption(z,g,m,c.utils.toWei(w.toFixed(18),"ether"),0,o?0:1,!0).call(),K=parseFloat(c.utils.fromWei(c.utils.toBN(J[0]))),I=parseFloat(c.utils.fromWei(J[3])),X=(o?K:K/I)/r*w,H=r/I;(parseInt(u,16)==0||i<H)&&(i=H,u=z,a=I,l=X)}return e?{volatility:a.toLocaleString(void 0,{style:"percent",minimumFractionDigits:0}),premium:`${P(r).round(5)}${C}`,volpremium:`${P(i).round(5)}${q}`}:{volatility:a,premium:r,volpremium:i,notional:l,voltoken:E,pool:u}}catch(s){return console.log(s.message),{volatility:"-",premium:"-",volpremium:"-",error:s.message}}},At=async t=>{const e=await v(c,p("Moret.json"),S),o=await e.methods.broker().call(),n=await(await v(c,p("MoretBroker.json"),o)).methods.getAllPools(t).call();var i=[];for(let l=0;l<n.length;l++)await e.methods.existVolTradingPool(n[l]).call()&&i.push(n[l]);return i},Ot=async(t=null,e,o,r)=>{const n=t||k(),i=await v(c,p("Moret.json"),S),l=await nt(n,null,e,o,r);var a=await ethereum.request({method:"eth_requestAccounts"}),u=c.utils.toChecksumAddress(a[0]);if(e){const s=await i.methods.funding().call(),h=await v(c,p("ERC20.json"),s);await G(h,u,F,l.premium)}else{const s=c.utils.toChecksumAddress(l.voltoken),h=await v(c,p("ERC20.json"),s);await G(h,u,F,l.volpremium)}},_t=async(t=null,e,o,r)=>{try{const s=t||k(),h=await nt(s,null,e,o,r),f=c.utils.toChecksumAddress(h.pool),g=c.utils.toWei(h.notional.toFixed(18),"ether"),N=Math.floor(r*86400);var n=await ethereum.request({method:"eth_requestAccounts"}),i=c.utils.toChecksumAddress(n[0]);const T=await v(c,p("Exchange.json"),F);var l=await c.eth.getGasPrice(),a=await T.methods.tradeVolToken(f,N,g,e?0:1).estimateGas({from:i,gasPrice:l});a=Number(c.utils.toBN(a).mul(c.utils.toBN(Number(150))).div(c.utils.toBN(Number(100))));var u=await c.eth.getTransactionCount(i);await T.methods.tradeVolToken(f,N,g,e?0:1).send({from:i,gas:a,gasPrice:l,nonce:u}).on("transactionHash",m=>(console.log(`https://polygonscan.com/tx/${m}`),`https://polygonscan.com/tx/${m}`)).on("error",function(m,w){return""})}catch(s){return console.warn(s),""}};export{P as B,jt as a,Wt as b,xt as c,St as d,ot as e,yt as f,Dt as g,Vt as h,Bt as i,$t as j,nt as k,Ot as l,_t as m,c as w};
