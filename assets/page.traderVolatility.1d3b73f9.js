import{k as v,l as u,o as h,p as b,t as p,q as x,r as T,u as m,d as g,s as w,a as f,v as q,x as S,y,z as C,A}from"./main.1e50200b.js";var V={globals:{elem:document.querySelector(".trader-volatility"),init:!0,execIntervalId:null},init(){this.optAmount(),this.buttonTrade(),document.querySelector(".transactions .js-refresh").addEventListener("click",()=>this.transactionsTable());const e={childList:!0,attributes:!0,attributeFilter:["sidenav-activechange","sidenav-refreshprice"]};new MutationObserver(i=>{console.log("sidenav refreshed from Trader Volatility!");for(let r of i)if(r.type==="attributes")switch(r.attributeName){case"sidenav-activechange":v.createGraph(),this.optExpiry(),this.optPrice(),this.liquidityPool(),this.transactionsTable();break;case"sidenav-refreshprice":this.optPrice(),document.querySelector(".overlay-popup")&&this.optPrice(!0);break}this.globals.init=!1}).observe(this.globals.elem.querySelector(".sidenav"),e);const a={attributes:!0,attributeFilter:["ts-activechanged","dds-updated"]},o=new MutationObserver(i=>{for(let r of i)if(r.attributeName==="ts-activechanged"||r.attributeName==="dds-updated"){if(r.target.classList.contains("opt-callput")){const s=document.querySelector(".opt-strike");parseInt(s.getAttribute("dds-selected"))===0&&u.valueFromInputField(s,s.querySelector(".ds-value1").textContent),this.optStrike()}this.optPrice()}});o.observe(document.querySelector(".opt-buysell"),a),o.observe(document.querySelector(".opt-expiry"),a);const n=new MutationObserver(i=>{n.disconnect()});n.observe(document.querySelector(".opt-expiry .ds-value1"),{childList:!0})},optAmount(){document.querySelector("input[name='opt-amount']").addEventListener("keydown",t=>{t.keyCode==13&&this.optPrice()},!1)},optExpiry(){u.createListItems(document.querySelector(".opt-expiry"),h())},optPrice(e=!1){new Promise((t,a)=>{setTimeout(()=>{t({amount:this.getAmountValue(),expiry:this.getExpiryValue()})},this.globals.init?2e3:500)}).then(async t=>{const a=await b(null,p(),this.isBuy(),t.amount,t.expiry);e?(document.querySelector(".overlay-popup .to-volatility span").textContent=a.volatility,document.querySelector(".overlay-popup .to-vol-premium span").textContent=a.volpremium):(document.querySelector(".opt-price .info-volatility").textContent=a.volatility,document.querySelector(".opt-price .info-vol-premium").textContent=a.volpremium)}).catch(t=>console.warn(t))},async liquidityPool(){const e=await x();document.querySelector(".liquidity-pool .pb-price-end").textContent=e.gross,document.querySelector(".liquidity-pool .pb-price-from").textContent=e.utilized,document.querySelector(".liquidity-pool .pb-text-value").textContent=e.text,T.progressBar(document.querySelector(".liquidity-pool"),e.perc)},buttonTrade(){document.querySelector(".opt-price .btn").addEventListener("click",async t=>{t.preventDefault();const a=[{name:`${m.getActiveItem(document.querySelector(".opt-buysell"))}:`,span:`volatility token on ${p()} - ${g()}`,class:"to-buy"},{name:"Expiry:",span:"-",class:"to-expiry"},{name:"Dollar Amount:",span:this.getAmountValue(),class:"to-amount"},{name:"Implied Volatility:",span:"-",class:"to-volatility"},{name:"Volatility Token Amount:",span:"-",class:"to-vol-premium"}];w("Trade overview",f(a,"tradeoverview")),u.insertValues(document.querySelector(".opt-expiry"),document.querySelector(".overlay-popup .to-expiry span"),!0),this.optPrice(!0),setTimeout(()=>this.executeTrade(),500)})},executeTrade(){const e=document.createElement("div");e.className="executetrade",document.querySelector(".overlay-popup .op-content").appendChild(e);const t=document.createElement("a");t.setAttribute("href","#"),t.className="btn btn-blue",t.textContent="Execute",e.appendChild(t),t.addEventListener("click",async a=>{a.preventDefault(),t.remove();const o=document.createElement("div");o.className="await-approval",o.textContent="Awaiting for allowance approval";const n=document.createElement("div");n.className="await-approval-timer",n.textContent="00:00",o.appendChild(n),e.appendChild(o);const i=document.createElement("div");i.className="await-trade",i.textContent="Awaiting for transaction";const r=document.createElement("div");r.className="await-trade-timer",r.textContent="00:00",i.appendChild(r),e.appendChild(i),this.executeTradeTimer(n);const s="Warning: Transaction has failed.";await q(null,this.isBuy(),this.getAmountValue(),this.getExpiryValue())==="failure"?this.executeTradeFailure(e,s):(o.classList.add("await-active"),o.textContent="Allowance approved.",n.remove(),this.clearTradeTimer(),setTimeout(async()=>{this.executeTradeTimer(r);const d=await S(null,this.isBuy(),this.getAmountValue(),this.getExpiryValue());if(d==="")this.executeTradeFailure(e,s);else{i.classList.add("await-active"),i.textContent="Transaction mined.",r.remove(),this.clearTradeTimer();const c=document.createElement("div");c.className="approve-trade-link";const l=document.createElement("a");l.setAttribute("href",d),l.setAttribute("target","_blank"),l.className="link-arrow",l.textContent="View on Polygonscan",c.appendChild(l),e.appendChild(c)}},500))},!1)},executeTradeFailure(e,t){const a=document.createElement("div");a.className="await-failure";const o=document.createElement("div");o.className="warning-icon";const n=document.createElement("div");n.className="warning-text",n.textContent=t,a.appendChild(o),a.appendChild(n),e.appendChild(a)},executeTradeTimer(e){const t=o=>o>9?o:`0${o}`;let a=0;this.globals.execIntervalId=setInterval(()=>{a++,a>120?(this.executeTradeFailure(document.querySelector(".overlay-popup .executetrade"),"Warning: Transaction has taking longer than normal to be mined. You can close the window and try to trade again."),this.clearTradeTimer()):e.textContent=`${t(parseInt(a/60))}:${t(a%60)}`},1e3)},clearTradeTimer(){clearInterval(this.globals.execIntervalId),this.globals.execIntervalId=null,console.log("clearTradeTimer()")},transactionsTable(){const e=document.querySelector(".transactions");y(e);const t=document.querySelector(".transactions .comp-dynamic-table");t.innerHTML=`
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th class="sortable sort-text">Token</th>
                            <th class="sortable">Tenor</th>
                            <th class="sortable">Amount</th>
                            <th class="sortable">Implied Volatility</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>`,C(null).then(a=>{y(e,!1);const o=[];a.forEach(n=>{o.push([n.Token,n.Tenor,n.Amount,n.ImpliedVolatility])}),A.setDynamic(t,o)})},isBuy(){return m.getActiveItem(document.querySelector(".opt-buysell")).toLowerCase()==="buy"},getAmountValue(){return document.querySelector("input[name='opt-amount']").value},getExpiryValue(){return document.querySelector(".opt-expiry .ds-value1").textContent.replace("Days","").replace("Day","").trim()}};export{V as default};
