import{p as y,t as d,r as v,u as h,v as g,x,y as b,a as S,s as T,d as q,z as k,A as w}from"./main.ca00b66d.js";import c from"./component.dropdownSelect.69555ea6.js";import C from"./component.percentageBar.6a9f6ee9.js";import u from"./component.toggleSwitches.d31686b5.js";import f from"./component.tradingviewWidget.39e7020b.js";var L={globals:{elem:document.querySelector(".trader"),init:!0,execIntervalId:null},init(){this.optAmount(),this.optExpiry(),this.buttonTrade(),y();const e={childList:!0,attributes:!0,attributeFilter:["sidenav-activechange","sidenav-refreshprice"]};new MutationObserver(i=>{console.log("sidenav refreshed from Trader!");for(let r of i)if(r.type==="attributes")switch(r.attributeName){case"sidenav-activechange":f.createGraph(),this.optTokenName(),document.querySelector(".opt-strike").removeAttribute("dds-selected"),this.optStrike(!0),this.optPrice(),this.liquidityPool(),this.globals.init||this.optToken();break;case"sidenav-refreshprice":this.optPrice(),document.querySelector(".overlay-popup")&&this.optPrice(!0);break}this.globals.init=!1}).observe(this.globals.elem.querySelector(".sidenav"),e);const t={attributes:!0,attributeFilter:["ts-activechanged","dds-updated"]},a=new MutationObserver(i=>{for(let r of i)if(r.attributeName==="ts-activechanged"||r.attributeName==="dds-updated"){if(r.target.classList.contains("opt-callput")){const s=document.querySelector(".opt-strike");parseInt(s.getAttribute("dds-selected"))===0&&c.valueFromInputField(s,s.querySelector(".ds-value1").textContent),this.optStrike()}else r.target.classList.contains("opt-expiry")&&this.optToken();this.optPrice()}});a.observe(document.querySelector(".opt-buysell"),t),a.observe(document.querySelector(".opt-callput"),t),a.observe(document.querySelector(".opt-token"),t),a.observe(document.querySelector(".opt-strike"),t),a.observe(document.querySelector(".opt-expiry"),t);const n=new MutationObserver(i=>{this.optToken(),n.disconnect()});n.observe(document.querySelector(".opt-expiry .ds-value1"),{childList:!0})},optTokenName(){document.querySelector(".opt-token .ts-token-name").textContent=d()},async optToken(){const e=await v(null,this.getExpiryValue());document.querySelector(".opt-token .ts-token").textContent=e},optStrike(e=!1){c.createListItems(document.querySelector(".opt-strike"),h(null,this.isCall()),!1,e)},optAmount(){document.querySelector("input[name='opt-amount']").addEventListener("keydown",o=>{o.keyCode==13&&this.optPrice()},!1)},optExpiry(){c.createListItems(document.querySelector(".opt-expiry"),g())},optPrice(e=!1){new Promise((o,t)=>{setTimeout(()=>{o({strike:this.getStrikeValue(),amount:this.getAmountValue(),expiry:this.getExpiryValue()})},this.globals.init?2e3:500)}).then(async o=>{const t=await x(null,d(),this.isBuy(),this.isCall(),this.getPaymentMethodValue(),o.strike,o.amount,o.expiry);e?(document.querySelector(".overlay-popup .to-volatility span").textContent=t.volatility,document.querySelector(".overlay-popup .to-premium span").textContent=t.premium,document.querySelector(".overlay-popup .to-collateral span").textContent=t.collateral):(document.querySelector(".opt-price .info-volatility").textContent=t.volatility,document.querySelector(".opt-price .info-premium").textContent=t.premium,document.querySelector(".opt-price .info-collateral").textContent=t.collateral)}).catch(o=>console.warn(o))},async liquidityPool(){const e=await b();document.querySelector(".liquidity-pool .pb-price-end").textContent=e.gross,document.querySelector(".liquidity-pool .pb-price-from").textContent=e.utilized,document.querySelector(".liquidity-pool .pb-text-value").textContent=e.text,C.progressBar(document.querySelector(".liquidity-pool"),e.perc)},buttonTrade(){document.querySelector(".opt-price .btn").addEventListener("click",async o=>{o.preventDefault();const t=[{name:`${u.getActiveItem(document.querySelector(".opt-buysell"))}:`,span:`${u.getActiveItem(document.querySelector(".opt-callput")).toLowerCase()} on ${d()} - ${S()}`,class:"to-buy"},{name:"Strike:",span:"-",class:"to-strike"},{name:"Expiry:",span:"-",class:"to-expiry"},{name:"Amount:",span:this.getAmountValue(),class:"to-amount"},{name:"Implied Volatility:",span:"-",class:"to-volatility"},{name:"Premium:",span:"-",class:"to-premium"},{name:"Collateral:",span:"-",class:"to-collateral"}];T("Trade overview",q(t,"tradeoverview")),c.insertValues(document.querySelector(".opt-strike"),document.querySelector(".overlay-popup .to-strike span")),c.insertValues(document.querySelector(".opt-expiry"),document.querySelector(".overlay-popup .to-expiry span"),!0),this.optPrice(!0),setTimeout(()=>this.executeTrade(),500)})},executeTrade(){const e=document.createElement("div");e.className="executetrade",document.querySelector(".overlay-popup .op-content").appendChild(e);const o=document.createElement("a");o.setAttribute("href","#"),o.className="btn btn-blue",o.textContent="Execute",e.appendChild(o),o.addEventListener("click",async t=>{t.preventDefault(),o.remove();const a=document.createElement("div");a.className="await-approval",a.textContent="Awaiting for allowance approval";const n=document.createElement("div");n.className="await-approval-timer",n.textContent="00:00",a.appendChild(n),e.appendChild(a);const i=document.createElement("div");i.className="await-trade",i.textContent="Awaiting for transaction";const r=document.createElement("div");r.className="await-trade-timer",r.textContent="00:00",i.appendChild(r),e.appendChild(i),this.executeTradeTimer(n);const s="Warning: Transaction has failed.";await k(null,this.isBuy(),this.isCall(),this.getPaymentMethodValue(),this.getStrikeValue(),this.getAmountValue(),this.getExpiryValue())==="failure"?this.executeTradeFailure(e,s):(a.classList.add("await-active"),a.textContent="Allowance approved.",n.remove(),this.clearTradeTimer(),setTimeout(async()=>{this.executeTradeTimer(r);const m=await w(null,this.isBuy(),this.isCall(),this.getPaymentMethodValue(),this.getStrikeValue(),this.getAmountValue(),this.getExpiryValue());if(m==="")this.executeTradeFailure(e,s);else{i.classList.add("await-active"),i.textContent="Transaction mined.",r.remove(),this.clearTradeTimer();const p=document.createElement("div");p.className="approve-trade-link";const l=document.createElement("a");l.setAttribute("href",m),l.setAttribute("target","_blank"),l.className="link-arrow",l.textContent="View on Polygonscan",p.appendChild(l),e.appendChild(p)}},500))},!1)},executeTradeFailure(e,o){const t=document.createElement("div");t.className="await-failure";const a=document.createElement("div");a.className="warning-icon";const n=document.createElement("div");n.className="warning-text",n.textContent=o,t.appendChild(a),t.appendChild(n),e.appendChild(t)},executeTradeTimer(e){const o=a=>a>9?a:`0${a}`;let t=0;this.globals.execIntervalId=setInterval(()=>{t>120?(this.executeTradeFailure(document.querySelector(".overlay-popup .executetrade"),"Warning: Transaction has taking longer than normal to be mined. You can close the window and try to trade again."),this.clearTradeTimer()):(t++,e.textContent=`${o(parseInt(t/60))}:${o(t%60)}`)},1e3)},clearTradeTimer(){clearInterval(this.globals.execIntervalId),this.globals.execIntervalId=null,console.log("clearTradeTimer()")},isBuy(){return u.getActiveItem(document.querySelector(".opt-buysell")).toLowerCase()==="buy"},isCall(){return u.getActiveItem(document.querySelector(".opt-callput")).toLowerCase()==="call"},getPaymentMethodValue(){return u.getActiveItem(document.querySelector(".opt-token"),!0)},getStrikeValue(){return document.querySelector(".opt-strike .ds-value1").textContent.trim()},getAmountValue(){return document.querySelector("input[name='opt-amount']").value},getExpiryValue(){return document.querySelector(".opt-expiry .ds-value1").textContent.replace("Days","").replace("Day","").trim()}};export{L as default};
