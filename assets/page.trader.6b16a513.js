import{d,f as h,s as v,i as g}from"./main.5c9c8bce.js";import{a as b,b as x,d as T,e as S,f as k,h as f,i as w,j as q}from"./web3.fdeecd27.js";import c from"./component.dropdownSelect.e85a045c.js";import C from"./component.percentageBar.b46f130e.js";import y from"./component.tables.1018d22d.js";import u from"./component.toggleSwitches.d31686b5.js";import A from"./component.tradingviewWidget.d4591575.js";var M={globals:{elem:document.querySelector(".trader"),init:!0,execIntervalId:null},init(){this.optAmount(),this.optExpiry(),this.buttonTrade(),this.transactionsTable();const t={childList:!0,attributes:!0,attributeFilter:["sidenav-activechange","sidenav-refreshprice"]};new MutationObserver(i=>{console.log("sidenav has changed from Trader!");for(let r of i)if(r.type==="attributes")switch(r.attributeName){case"sidenav-activechange":A.createGraph(),this.optTokenName(),document.querySelector(".opt-strike").removeAttribute("dds-selected"),this.optStrike(!0),this.optPrice(),this.liquidityPool(),this.globals.init||this.optToken();break;case"sidenav-refreshprice":this.optPrice(),document.querySelector(".overlay-popup")&&this.optPrice(!0);break}this.globals.init=!1}).observe(this.globals.elem.querySelector(".sidenav"),t);const e={attributes:!0,attributeFilter:["ts-activechanged","dds-updated"]},a=new MutationObserver(i=>{for(let r of i)if(r.attributeName==="ts-activechanged"||r.attributeName==="dds-updated"){if(r.target.classList.contains("opt-callput")){const s=document.querySelector(".opt-strike");parseInt(s.getAttribute("dds-selected"))===0&&c.valueFromInputField(s,s.querySelector(".ds-value1").textContent),this.optStrike()}else r.target.classList.contains("opt-expiry")&&this.optToken();this.optPrice()}});a.observe(document.querySelector(".opt-buysell"),e),a.observe(document.querySelector(".opt-callput"),e),a.observe(document.querySelector(".opt-token"),e),a.observe(document.querySelector(".opt-strike"),e),a.observe(document.querySelector(".opt-expiry"),e);const n=new MutationObserver(i=>{this.optToken(),n.disconnect()});n.observe(document.querySelector(".opt-expiry .ds-value1"),{childList:!0})},optTokenName(){document.querySelector(".opt-token .ts-token-name").textContent=d()},async optToken(){const t=await b(null,this.getExpiryValue());document.querySelector(".opt-token .ts-token").textContent=t},optStrike(t=!1){c.createListItems(document.querySelector(".opt-strike"),x(null,this.isCall()),!1,t)},optAmount(){document.querySelector("input[name='opt-amount']").addEventListener("keydown",o=>{o.keyCode==13&&this.optPrice()},!1)},optExpiry(){c.createListItems(document.querySelector(".opt-expiry"),T())},optPrice(t=!1){new Promise((o,e)=>{setTimeout(()=>{o({strike:this.getStrikeValue(),amount:this.getAmountValue(),expiry:this.getExpiryValue()})},this.globals.init?2e3:500)}).then(async o=>{const e=await S(null,d(),this.isBuy(),this.isCall(),this.getPaymentMethodValue(),o.strike,o.amount,o.expiry);t?(document.querySelector(".overlay-popup .to-volatility span").textContent=e.volatility,document.querySelector(".overlay-popup .to-premium span").textContent=e.premium,document.querySelector(".overlay-popup .to-collateral span").textContent=e.collateral):(document.querySelector(".opt-price .info-volatility").textContent=e.volatility,document.querySelector(".opt-price .info-premium").textContent=e.premium,document.querySelector(".opt-price .info-collateral").textContent=e.collateral)}).catch(o=>console.warn(o))},async liquidityPool(){const t=await k();document.querySelector(".liquidity-pool .pb-price-end").textContent=t.gross,C.progressBar(document.querySelector(".liquidity-pool"),t.perc)},buttonTrade(){document.querySelector(".opt-price .btn").addEventListener("click",async o=>{o.preventDefault();const e=[{name:`${u.getActiveItem(document.querySelector(".opt-buysell"))}:`,span:`${u.getActiveItem(document.querySelector(".opt-callput")).toLowerCase()} on ${d()} - ${h()}`,class:"to-buy"},{name:"Strike:",span:"-",class:"to-strike"},{name:"Expiry:",span:"-",class:"to-expiry"},{name:"Amount:",span:this.getAmountValue(),class:"to-amount"},{name:"Implied Volatility:",span:"-",class:"to-volatility"},{name:"Premium:",span:"-",class:"to-premium"},{name:"Collateral:",span:"-",class:"to-collateral"}];v("Trade overview",g(e,"tradeoverview")),c.insertValues(document.querySelector(".opt-strike"),document.querySelector(".overlay-popup .to-strike span")),c.insertValues(document.querySelector(".opt-expiry"),document.querySelector(".overlay-popup .to-expiry span"),!0),this.optPrice(!0),setTimeout(()=>this.executeTrade(),500)})},executeTrade(){const t=document.createElement("div");t.className="executetrade",document.querySelector(".overlay-popup .op-content").appendChild(t);const o=document.createElement("a");o.setAttribute("href","#"),o.className="btn btn-blue",o.textContent="Execute",t.appendChild(o),o.addEventListener("click",async e=>{e.preventDefault(),o.remove();const a=document.createElement("div");a.className="await-approval",a.textContent="Awaiting for allowance approval";const n=document.createElement("div");n.className="await-approval-timer",n.textContent="00:00",a.appendChild(n),t.appendChild(a);const i=document.createElement("div");i.className="await-trade",i.textContent="Awaiting for transaction";const r=document.createElement("div");r.className="await-trade-timer",r.textContent="00:00",i.appendChild(r),t.appendChild(i),this.executeTradeTimer(n);const s="Warning: Transaction has failed.";await f(null,this.isBuy(),this.isCall(),this.getPaymentMethodValue(),this.getStrikeValue(),this.getAmountValue(),this.getExpiryValue())==="failure"?this.executeTradeFailure(t,s):(a.classList.add("await-active"),n.remove(),this.clearTradeTimer(),setTimeout(async()=>{this.executeTradeTimer(r);const m=await w(null,this.isBuy(),this.isCall(),this.getPaymentMethodValue(),this.getStrikeValue(),this.getAmountValue(),this.getExpiryValue());if(m==="")this.executeTradeFailure(t,s);else{i.classList.add("await-active"),r.remove(),this.clearTradeTimer();const p=document.createElement("div");p.className="approve-trade-link";const l=document.createElement("a");l.setAttribute("href",m),l.setAttribute("target","_blank"),l.className="link-arrow",l.textContent="View on Polygonscan",p.appendChild(l),t.appendChild(p)}},500))},!1)},executeTradeFailure(t,o){const e=document.createElement("div");e.className="await-failure";const a=document.createElement("div");a.className="warning-icon";const n=document.createElement("div");n.className="warning-text",n.textContent=o,e.appendChild(a),e.appendChild(n),t.appendChild(e)},executeTradeTimer(t){const o=a=>a>9?a:`0${a}`;let e=0;this.globals.execIntervalId=setInterval(()=>{e++,e>120?(this.executeTradeFailure(document.querySelector(".overlay-popup .executetrade"),"Warning: Transaction has taking longer than normal to be mined. You can close the window and try to trade again."),this.clearTradeTimer()):t.textContent=`${o(parseInt(e/60))}:${o(e%60)}`},1e3)},clearTradeTimer(){clearInterval(this.globals.execIntervalId),this.globals.execIntervalId=null,console.log("clearTradeTimer()")},transactionsTable(){q(null,9e3,null).then(t=>{const o=document.querySelector(".transactions .comp-tables-dynamic");t.forEach(e=>{y.setRows(o,[e.Type,e.BS,e.Expiry,e.Strike,e.Amount,e.Delta,e.Gamma,e.Vega,e.Theta])}),y.setTable(o,!0)})},isBuy(){return u.getActiveItem(document.querySelector(".opt-buysell")).toLowerCase()==="buy"},isCall(){return u.getActiveItem(document.querySelector(".opt-callput")).toLowerCase()==="call"},getPaymentMethodValue(){return u.getActiveItem(document.querySelector(".opt-token"),!0)},getStrikeValue(){return document.querySelector(".opt-strike .ds-value1").textContent.trim()},getAmountValue(){return document.querySelector("input[name='opt-amount']").value},getExpiryValue(){return document.querySelector(".opt-expiry .ds-value1").textContent.replace("Days","").replace("Day","").trim()}};export{M as default};
